import{r,u as K,a as Q,b as W,s as c,j as e}from"./index-Dh21qyBZ.js";import{P as X}from"./Publicar-DMM5_1B-.js";/* empty css             */function ee(){const d=r.useRef(!1),p=r.useRef(),_=K(),{server:y,navigate:I,cargo:S}=_,P=Q(),v={permission:r.useRef(null),descricao:r.useRef(null)},R=W(),[f,j]=r.useState([{filename:"Upload",src:c,resize:!1,refs:{image_view:r.createRef(),image:r.createRef(),input:r.createRef(),resize:r.createRef()}}]),[l,w]=r.useState({filename:"Upload",src:c,resize:!1,refs:{image_view:r.createRef(),image:r.createRef(),input:r.createRef(),resize:r.createRef()}}),[J,U]=r.useState(!1),[B,F]=r.useState(!1),[b,D]=r.useState(((S.current.cargo||0)&4)==4),[C,E]=r.useState(!1),A=s=>(s||f).filter(a=>a.src==c).length==1,q=()=>{F(!0);const s=setTimeout(()=>{F(!1),clearTimeout(s)},2e3)},O=(s,a,t)=>{const i=s.target.files[0];if(i){const g=new FileReader;g.onloadend=()=>{const n=g.result instanceof ArrayBuffer?g.result:new ArrayBuffer(0),m=new Uint8Array(n),N={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let x=null;for(const[o,h]of Object.entries(N))if(h.every((z,H)=>z===m[H])){x=o;break}if(x&&x=="jpeg"){const o=new FileReader;o.onloadend=()=>{var h="";typeof o.result=="string"?h=o.result:h=c,a?w(u=>({...u,filename:i.name,src:h})):j(u=>{const z=A(u)&&u[t].src==c;return u[t]={...u[t],filename:i.name,src:h},z?[...u,{filename:"Upload",src:c,resize:!1,refs:{image_view:r.createRef(),image:r.createRef(),input:r.createRef(),resize:r.createRef()}}]:[...u]})},o.readAsDataURL(i)}else a?w(o=>({...o,filename:"Upload",src:c})):j(o=>(o[t]={...o[t],filename:"Upload",src:c},[...o])),s.target.value="",q()},g.readAsArrayBuffer(i)}},L=s=>{D((s&4)==4)},T=()=>{b&&(v.permission.current.value=p.current.privado?"1":"0",E(p.current.privado))};r.useEffect(()=>(d.current=R.pathname=="/admin/imagens_edit",_.setSelected("publicar"),d.current&&P.post(y+"/admin/imagens_edit"+R.search,{type:"info"}).then(s=>{const a=s.data.post_edit;v.descricao.current.value=a.descricao,a.privado=(a.privado&2)==2,p.current=a;const t=JSON.parse(a.imagem);j(t.map(i=>({filename:"Image.webp",src:y+"/images/"+encodeURIComponent(i),resize:a.imagem.slice(0,2)=="r_"||a.imagem.slice(2,4)=="r_",refs:{image_view:r.createRef(),image:r.createRef(),input:r.createRef(),resize:r.createRef()}})))}),S.current.addListener(L),()=>{S.current.removeListener(L)}),[]),r.useEffect(()=>{p.current&&T()},[b]);const V=async s=>{if(s.preventDefault(),!A())return;var t=new FormData,i=v.descricao.current.value;const g=[];for(const n of f)n.src!=c&&g.push(!!JSON.parse(n.refs.resize.current.value));if(d.current)t.append("id",p.current.id.toString());else{const n=[];for(const m of f)m.src!=c&&n.push(m.refs.input.current.files.length>0?m.refs.input.current.files[0]:null);if(n.forEach(m=>t.append("imageFile[]",m)),C){const m=l.refs.input.current.files.length>0?l.refs.input.current.files[0]:null;t.append("imageFilePremium",m)}}if(t.append("type","option"),i!=""&&t.append("descricao",i),t.append("original_formats",JSON.stringify(g)),C){t.append("permission","true");const n=!!JSON.parse(l.refs.resize.current.value);n&&t.append("original_format_premium",n.toString())}P.post(y+"/admin/imagens_cadastro?type="+(d.current?"edit":"cadastro"),t,{arquivo:!0}).then(n=>{if(n.error)_.redirectError.current(n.error);else if(n.data.result=="true"){if(d.current){const N=new URLSearchParams(R.search);if(N.has("origin"))I(decodeURIComponent(N.get("origin")));else{const x=R.pathname.split("_");I(x[0]+"_lista")}d.current=!1,p.current=void 0}U(!0);var m=setTimeout(()=>{U(!1),clearInterval(m)},2e3);v.descricao.current.value="",j([{filename:"Upload",src:c,resize:!1,refs:{image_view:r.createRef(),image:r.createRef(),input:r.createRef(),resize:r.createRef()}}]),w({filename:"Upload",src:c,resize:!1,refs:{image_view:r.createRef(),image:r.createRef(),input:r.createRef(),resize:r.createRef()}})}})},G=s=>{E(s.target.value=="1")},k=(s,a)=>{const t=["rd","of"];if(s){const i=JSON.parse(l.refs.resize.current.value);l.refs.image.current.classList.replace(t[+i],t[+!i])}else{const i=JSON.parse(f[a].refs.resize.current.value);f[a].refs.image.current.classList.replace(t[+i],t[+!i])}},M=s=>{j(a=>a.filter((t,i)=>i!=s||t.src==c))};return r.useEffect(()=>{if(p.current)for(const s of f)s.refs.input.current&&(s.refs.input.current.required=!1)},[f]),e.jsxs("div",{id:"pg",className:"ic",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(X,{}),e.jsx("div",{id:"msg1",children:"Cadastrar imagem"}),e.jsxs("form",{onSubmit:V,children:[b?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:G,ref:v.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{ref:v.descricao}),e.jsx("label",{children:"Capa"}),e.jsx("div",{className:"image-list",children:f.map((s,a)=>e.jsxs("div",{className:"image-item",children:[e.jsx("div",{ref:s.refs.image_view,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:s.refs.image,className:"of",src:s.src})}),e.jsx("input",{className:"file",ref:s.refs.input,onChange:t=>O(t,!1,a),type:"file",accept:"image/jpg, image/jpeg",required:a==0||a+1<f.length}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{s.refs.input.current.click()},children:e.jsx("div",{className:"txt-1",children:s.filename})}),e.jsxs("div",{className:"options-image",children:[e.jsxs("select",{defaultValue:"true",onChange:()=>k(!1,a),ref:s.refs.resize,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]}),e.jsx("div",{onClick:()=>M(a),className:"remove-image"+(a+1<f.length||s.src!=c?"":" disabled"),children:"-"})]})]})]},a))}),C?e.jsxs("div",{className:"image-item",children:[e.jsx("label",{children:"Capa borrada"}),e.jsx("div",{ref:l.refs.image_view,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:l.refs.image,className:"of",src:l.src})}),e.jsx("input",{className:"file",ref:l.refs.input,onChange:s=>O(s,!0,0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{l.refs.input.current.click()},children:e.jsx("div",{className:"txt-1",children:l.filename})}),e.jsxs("select",{defaultValue:"true",onChange:()=>k(!0,0),ref:l.refs.resize,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:J?"flex":"none"},children:d.current?"Imagem alterada com sucesso.":"Imagem cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:B?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{ee as default};
