import{r as i,u as ve,a as we,b as je,s as f,j as r}from"./index-4q9H0rLT.js";import{P as xe}from"./Publicar-NIoh8R9A.js";/* empty css             */const y=10000n<<18n|10000n;function Ne(){const x=i.useRef(!1),p=i.useRef(),P=ve(),{server:W,navigate:G,cargo:L}=P,V=we(),I={permission:i.useRef(null),descricao:i.useRef(null)},E=je(),[g,N]=i.useState([{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:f,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]),[u,_]=i.useState({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:f,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}),[$,O]=i.useState({normal:0,premium:0}),[D,K]=i.useState(!1),[se,Q]=i.useState(!1),[C,ne]=i.useState(((L.current.cargo||0)&4)==4),[S,B]=i.useState(!1),X=e=>(e||g).filter(t=>t.src==f).length==1,ae=()=>{Q(!0);const e=setTimeout(()=>{Q(!1),clearTimeout(e)},2e3)},H=(e,t,s,o,c)=>{const{width:n,height:a}=c||o.refs.image_view.current.getBoundingClientRect();var m=0,h=0,l=0,d=0;if(t<s)switch(e){case 0:m=t/s*n,h=a,l=m,d=h;break;case 1:m=n,h=a,l=m,d=s/t*a;break;case 2:m=a*4/5,h=a,l=m,d=h;break;case 3:m=n,h=n*9/16,l=m,d=s/t*a}else switch(e){case 0:m=n,h=s/t*a,l=m,d=h;break;case 1:m=n,h=a,l=t/s*n,d=a;break;case 2:m=a*4/5,h=a,l=t/s*n,d=a;break;case 3:m=n,h=n*9/16,l=m,d=h}const R=BigInt(Math.floor(l/d*1e4))&(1n<<18n)-1n,b=BigInt(e)<<18n;return[R|b,l+"px",d+"px",m+"px",h+"px"]},Y=(e,t,s)=>{const o=e.target.files[0];if(o){const c=new FileReader;c.onloadend=()=>{const n=c.result instanceof ArrayBuffer?c.result:new ArrayBuffer(0),a=new Uint8Array(n),m={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let h=null;for(const[l,d]of Object.entries(m))if(d.every((b,j)=>b===a[j])){h=l;break}if(h&&h=="jpeg"){const l=new FileReader;l.onloadend=()=>{var d="";typeof l.result=="string"?d=l.result:d=f;const R=new Image;R.src=d,R.onload=()=>{const b=Number(t?u.refs.resize.current.value:g[0].refs.resize.current.value)-1,{width:j,height:v}=R,[z,U,k,A,F]=H(b,j,v,t?u:g[s]);t?_(w=>({...w,aspect:z,elementWidth:U,elementHeight:k,imageWidth:j,imageHeight:v,width:A,height:F,filename:o.name,src:d})):N(w=>{const J=X(w)&&w[s].src==f;return w[s]={...w[s],aspect:z,imageWidth:j,imageHeight:v,elementWidth:U,elementHeight:k,width:A,height:F,filename:o.name,src:d},J?[...w,{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:f,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]:[...w]})}},l.readAsDataURL(o)}else t?_(l=>({...l,filename:"Upload",src:f})):N(l=>(l[s]={...l[s],imageWidth:0,imageHeight:0,width:"100%",height:"100%",filename:"Upload",src:f},[...l])),e.target.value="",ae()},c.readAsArrayBuffer(o)}},q=i.useCallback(e=>{ne((e&4)==4)},[]),ce=()=>{C&&(I.permission.current.value=p.current.privado?"1":"0",B(p.current.privado))},T=i.useCallback(()=>{S&&_(e=>{if(e.src==f)return e;const t=Number(u.refs.resize.current.value)-1,[s,o,c,n,a]=H(t,e.imageWidth,e.imageHeight,e);return e.aspect=s,e.elementWidth=o,e.elementHeight=c,e.width=n,e.height=a,{...e}}),N(e=>(e=e.map(t=>{if(t.src==f)return t;const s=Number(e[0].refs.resize.current.value)-1,[o,c,n,a,m]=H(s,t.imageWidth,t.imageHeight,t);return t.aspect=o,t.elementWidth=c,t.elementHeight=n,t.width=a,t.height=m,t}),[...e]))},[]);i.useEffect(()=>{x.current=E.pathname=="/admin/imagens_edit",P.setSelected("publicar"),x.current&&V.post(W+"/admin/imagens_edit"+E.search,{type:"info"}).then(e=>{const t=e.data.post_edit;I.descricao.current.value=t.descricao,t.privado=(t.privado&2)==2,C&&(I.permission.current.value=t.privado?"1":"0"),B(t.privado),p.current=t;const s=JSON.parse(t.imagem);var o=0;const c={};for(const n of s){const a=new Image;a.src=W+"/images/"+encodeURIComponent(n),a.onload=()=>{const{width:m,height:h}=a;if(c[n]={imageWidth:m,imageHeight:h},o++,o==s.length){const{width:d,height:R}=g[0].refs.image_view.current.getBoundingClientRect(),b={width:d,height:R};var l={normal:0,premium:0};const j=s.map(v=>{const z=v.match(/^(.*)(_\d+_i).*\.webp/),U=BigInt(`0x${BigInt(parseInt(z[1],36)).toString(16)}`),k=U>>8n;if(C&&(U&1n)==1n){const ee=k>>21n<<8n|2n,te=ee.toString(36)+z[2]+"_premium.webp",M=new Image;M.src=W+"/images/"+encodeURIComponent(te),M.onload=()=>{const{width:re,height:ie}=M;l.premium=Number(ee>>26n&(1n<<2n)-1n);const[de,ue,fe,ge,pe]=H(l.premium,re,ie,g[0],b);_({aspect:de,imageWidth:re,imageHeight:ie,elementWidth:ue,elementHeight:fe,width:ge,height:pe,filename:"Image.webp",src:W+"/images/"+encodeURIComponent(te),refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}})}}l.normal=Number(k>>18n&(1n<<2n)-1n);const[A,F,w,J,he]=H(l.normal,c[v].imageWidth,c[v].imageHeight,g[0],b);return{aspect:A,imageWidth:c[v].imageWidth,imageHeight:c[v].imageHeight,elementWidth:F,elementHeight:w,width:J,height:he,filename:"Image.webp",src:W+"/images/"+encodeURIComponent(v),refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}});j.push({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:f,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}),N(j),O(l)}}}})},[]),i.useEffect(()=>(L.current.addListener(q),window.addEventListener("resize",T),()=>{L.current.removeListener(q),window.removeEventListener("resize",T)}),[q,T]),i.useEffect(()=>{p.current&&ce()},[C]);const oe=async e=>{if(e.preventDefault(),!X())return;var s=new FormData,o=I.descricao.current.value;if(x.current)s.append("id",p.current.id.toString());else{const n=[];for(const a of g)a.src!=f&&n.push(a.refs.input.current.files.length>0?a.refs.input.current.files[0]:null);n.forEach(a=>s.append("imageFile[]",a))}if(S&&(!x.current||!p.current.privado)){const n=u.refs.input.current.files.length>0?u.refs.input.current.files[0]:null;s.append("imageFilePremium",n)}const c=[];for(const n of g)n.src!=f&&c.push(Number(n.aspect));if(s.append("type","option"),o!=""&&s.append("descricao",o),s.append("original_formats",JSON.stringify(c)),S){s.append("permission","true");const n=Number(u.aspect);n&&s.append("original_format_premium",n.toString())}V.post(W+"/admin/imagens_cadastro?type="+(x.current?"edit":"cadastro"),s,{arquivo:!0}).then(n=>{if(n.error)P.redirectError.current(n.error);else if(n.data.result=="true"){if(x.current){const m=new URLSearchParams(E.search);if(m.has("origin"))G(decodeURIComponent(m.get("origin")));else{const h=E.pathname.split("_");G(h[0]+"_lista")}x.current=!1,p.current=void 0}K(!0);var a=setTimeout(()=>{K(!1),clearInterval(a)},2e3);I.descricao.current.value="",N([{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:f,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]),O({normal:1,premium:1}),S&&(_({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:f,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}),B(!1))}})},le=e=>{B(e.target.value=="1")},Z=e=>{const t=Number(e?u.refs.resize.current.value:g[0].refs.resize.current.value)-1;e?_(o=>{if(o.src!=f){const[c,n,a,m,h]=H(t,o.imageWidth,o.imageHeight,o);return{...o,aspect:c,elementWidth:n,elementHeight:a,width:m,height:h}}return o}):N(o=>(o.map(c=>{if(c.src!=f){const[n,a,m,h,l]=H(t,c.imageWidth,c.imageHeight,c);c.aspect=n,c.elementWidth=a,c.elementHeight=m,c.width=h,c.height=l}return c}),[...o]));const s=e?u:g[0];O(o=>({...o,[e?"premium":"normal"]:Number(s.refs.resize.current.value)-1}))},me=e=>{N(t=>t.filter((s,o)=>o!=e||s.src==f))};return i.useEffect(()=>{if(p.current)for(const e of g)e.refs.input.current&&(e.refs.input.current.required=!1)},[g]),i.useEffect(()=>{D&&(g[0].refs.input.current.value="")},[D]),r.jsxs("div",{id:"pg",className:"ic",children:[r.jsxs("div",{id:"dt",className:"fechado",children:[r.jsx(xe,{}),r.jsx("div",{id:"msg1",children:"Cadastrar imagem"}),r.jsxs("form",{onSubmit:oe,children:[C?r.jsxs(r.Fragment,{children:[r.jsx("label",{children:"Disponível:"}),r.jsxs("select",{onChange:le,ref:I.permission,id:"permission",defaultValue:"0",children:[r.jsx("option",{value:"0",children:"Público"}),r.jsx("option",{value:"1",children:"Premium"})]})]}):r.jsx(r.Fragment,{}),r.jsx("label",{children:"Descrição"}),r.jsx("textarea",{ref:I.descricao}),r.jsx("label",{children:"Capa"}),r.jsx("div",{className:"image-list",children:g.map((e,t)=>r.jsxs("div",{className:"image-item",children:[r.jsx("div",{ref:e.refs.image_view,className:"imagem-view col-12 col-md-6",children:r.jsx("div",{className:"image-container",style:{width:e.width,height:e.height},children:r.jsx("img",{className:"image-img",style:{width:e.elementWidth,height:e.elementHeight},ref:e.refs.image,src:e.src})})}),r.jsx("input",{className:"file",ref:e.refs.input,onChange:s=>Y(s,!1,t),type:"file",accept:"image/jpg, image/jpeg",required:t==0||t+1<g.length}),r.jsxs("div",{className:"imagem-pt",children:[r.jsx("div",{className:"imagem",onClick:()=>{e.refs.input.current.click()},children:r.jsx("div",{className:"txt-1",children:e.filename})}),r.jsxs("div",{className:"options-image",children:[r.jsxs("select",{value:String($.normal+1),onChange:()=>t==0?Z(!1):()=>{},ref:e.refs.resize,className:"original_format"+(t>0?" disabled":""),children:[r.jsx("option",{value:"1",children:"Original"}),r.jsx("option",{value:"2",children:"1:1"}),r.jsx("option",{value:"3",children:"4:5"}),r.jsx("option",{value:"4",children:"16:9"})]}),r.jsx("div",{onClick:()=>me(t),className:"remove-image"+(t+1<g.length||e.src!=f?"":" disabled"),children:"-"})]})]})]},t))}),S?r.jsxs("div",{className:"image-item",children:[r.jsx("label",{children:"Capa borrada"}),r.jsx("div",{ref:u.refs.image_view,className:"imagem-view col-12 col-md-6",children:r.jsx("div",{className:"image-container",style:{width:u.width,height:u.height},children:r.jsx("img",{className:"image-img",style:{width:u.elementWidth,height:u.elementHeight},ref:u.refs.image,src:u.src})})}),r.jsx("input",{className:"file",ref:u.refs.input,onChange:e=>Y(e,!0,0),type:"file",accept:"image/jpg, image/jpeg",required:p.current?!p.current.privado:!0}),r.jsxs("div",{className:"imagem-pt",children:[r.jsx("div",{className:"imagem",onClick:()=>{u.refs.input.current.click()},children:r.jsx("div",{className:"txt-1",children:u.filename})}),r.jsxs("select",{value:String($.premium+1),onChange:()=>Z(!0),ref:u.refs.resize,className:"original_format",children:[r.jsx("option",{value:"1",children:"Original"}),r.jsx("option",{value:"2",children:"1:1"}),r.jsx("option",{value:"3",children:"4:5"}),r.jsx("option",{value:"4",children:"16:9"})]})]})]}):r.jsx(r.Fragment,{}),r.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),r.jsx("div",{id:"m",style:{display:D?"flex":"none"},children:x.current?"Imagem alterada com sucesso.":"Imagem cadastrada com sucesso."}),r.jsx("div",{id:"errorImage",style:{display:se?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{Ne as default};
