import{r as i,u as me,a as fe,s as y,j as e}from"./index-4zMaw5gP.js";import{P as ge}from"./Publicar-D22uTXtR.js";/* empty css             */function pe(){const C=me(),{server:j,navigate:I,cargo:N}=C,k=fe(),[$,H]=i.useState(!1),u=i.useRef(!1),p=i.useRef(),[O,E]=i.useState("Upload"),[W,U]=i.useState(!1),[V,P]=i.useState(!1),[G,J]=i.useState(0),[d,h]=i.useState([{titulo:"",input:i.createRef()}]),[x,m]=i.useState(!1),[z,q]=i.useState(!1),[K,A]=i.useState(!1),[Q,T]=i.useState("Upload"),[S,X]=i.useState(((N.current.cargo||0)&4)==4),[Y,Z]=i.useState(!1),l={permission:i.useRef(null),titulo:i.useRef(null),imagem:i.useRef(null),imagem_view:i.useRef(null),imagem_premium:i.useRef(null),imagem_view_premium:i.useRef(null),image_element_premium:i.useRef(null)},ee=()=>{A(!0);const t=setTimeout(()=>{A(!1),clearTimeout(t)},2e3)},te=()=>{q(!0);const t=setTimeout(()=>{q(!1),clearTimeout(t)},2e3)},[_,F]=i.useState({src:y,width:"100%",height:"100%"}),[R,M]=i.useState({src:y,width:"100%",height:"100%"}),f=(t,r)=>{if(typeof t=="string"){const s=new Image;s.onload=()=>{const n=l.imagem_view.current.offsetWidth,c=l.imagem_view.current.offsetHeight;var a=s.width,o=s.height;n/a*o>c?(a=c/o*a,o=c):(o=n/a*o,a=n),r?M({src:t,width:a,height:o}):F({src:t,width:a,height:o})},s.src=t}else r?M({src:y,width:window.innerWidth,height:window.innerHeight/1280*720}):F({src:y,width:window.innerWidth,height:window.innerHeight/1280*720})},D=(t,r)=>{const s=t.target.files[0];if(s){const n=new FileReader;n.onloadend=()=>{const c=n.result instanceof ArrayBuffer?n.result:new ArrayBuffer(0),a=new Uint8Array(c),o={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let g=null;for(const[v,ce]of Object.entries(o))if(ce.every((ue,de)=>ue===a[de])){g=v;break}if(g&&g=="jpeg"){r?T(s.name):E(s.name);const v=new FileReader;v.onloadend=()=>{f(v.result,r)},v.readAsDataURL(s)}else f(null,r),t.target.value="",te()},n.readAsArrayBuffer(s)}},re=t=>{P(!0),J(Math.floor(t.progress*100))},ie=i.useCallback(async t=>{if(t.preventDefault(),x||ee(),!x)return;const r=new FormData;for(const n of d){const c=n.input.current.files[0];r.append("musics[]",c,c.name)}const s=l.imagem.current.files[0];r.append("type","option"),u.current&&r.append("id",p.current.id.toString()),s&&r.append("imagem",s),s&&r.append("imagens_edit","true"),r.append("titulo",l.titulo.current.value),k.post(j+"/admin/musicas_cadastro?type="+(u.current?"edit":"cadastro"),r,u.current?{arquivo:!0}:{arquivo:!0,porcentagem:re}).then(n=>{if(n.error)C.redirectError.current(n.error);else if(n.data.result=="true"){if(u.current){const a=new URLSearchParams(location.search);if(a.has("origin"))I(decodeURIComponent(a.get("origin")));else{const o=location.pathname.split("_");I(o[0]+"_lista")}u.current=!1,p.current=void 0}P(!1),b.current.executed=!1,U(!0);var c=setTimeout(()=>{U(!1),clearTimeout(c)},2e3);l.titulo.current.value="",l.imagem.current.value="",T("Upload"),E("Upload"),h([{titulo:"",input:i.createRef()}]),f(null,!0),f(null,!1)}})},[d,x]);u.current=location.pathname=="/admin/musicas_edit";const b=i.useRef({length:0,finished:0,executed:!1}),L=t=>{X((t&4)==4)},B=()=>{S&&(l.permission.current.value=p.current.privado?"1":"0")};i.useEffect(()=>(C.setSelected("publicar"),H(u.current),u.current&&(m(!0),k.post(j+"/admin/musicas_edit"+location.search,{type:"info"}).then(t=>{if("post_edit"in t.data){l.imagem.current.required=!1;const r=t.data.post_edit[0];l.titulo.current.value=r.titulo,r.arquivo=JSON.parse(r.arquivo),h(Array.from({length:r.arquivo.length},(s,n)=>({titulo:r.arquivo[n].replace(/\.[^/.]+$/,""),input:i.createRef()}))),r.privado=(r.privado&2)==2,p.current=r,B(),f(j+"/images/"+encodeURIComponent(r.imagem.slice(2)),!0),f(j+"/images/"+encodeURIComponent(r.imagem),!1)}})),N.current.addListener(L),()=>{N.current.removeListener(L)}),[]),i.useEffect(()=>{p.current&&B()},[S]);const se=()=>{m(!1),h(t=>[...t,{titulo:"",input:i.createRef()}])},w=i.useRef([]);i.useEffect(()=>{if(d.length>1){for(const t of w.current){const r=new DataTransfer;r.items.add(t[1]),d[t[0]].input.current.files=r.files}w.current=[]}},[d]);const ae=i.useCallback(t=>{if(!u.current){var r=0;h(s=>{const n=s[t].input.current.files.length;if(s=s.map((a,o)=>{if(t==o&&a.input.current.files.length>0){const g=a.input.current.files.length;return r+=g,o==s.length-1&&r==s.length+g-1&&m(!0),{...a,titulo:a.input.current.files[0].name.replace(/\.[^/.]+$/,"")}}else if(a.titulo!=""&&a.input.current.files.length>0)r++,o==s.length-1&&r==s.length&&m(!0);else if(a.titulo!=""&&a.input.current.files.length==0)return m(!1),{...a,titulo:""};return a}),n>0){const a=[];w.current=[];for(var c=1;c<n;c++){const o={titulo:s[t].input.current.files[c].name.replace(/\.[^/.]+$/,""),input:i.createRef()};w.current.push([t+c,s[t].input.current.files[c]]),a.push(o)}s.splice(t+1,0,...a)}return b.current.length=s.length,s})}},[d]),ne=i.useCallback(t=>{u.current||d[t].input.current.click()},[d]),le=t=>{t>0&&!u.current&&h(r=>(r.length>1&&(r.splice(t,1),m(!0)),b.current.length=r.length,[...r]))},oe=t=>{Z(t.target.value=="1")};return e.jsx("div",{id:"pg",className:"mc",children:e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(ge,{}),e.jsx("div",{id:"msg1",children:"Cadastrar música"}),e.jsxs("form",{onSubmit:ie,children:[S?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:oe,ref:l.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Título"}),e.jsx("input",{ref:l.titulo,className:"input",id:"titulo",placeholder:"Insira um título",required:!0}),e.jsx("label",{children:"Música"}),e.jsx("div",{className:"list-music"+($?" edit":""),children:d.map((t,r)=>e.jsxs("div",{className:"item-music"+(r==0?" first":""),children:[e.jsx("div",{className:"count-music",children:r+1}),e.jsx("div",{className:"title-music",children:t.titulo}),e.jsx("input",{onChange:()=>{ae(r)},ref:t.input,className:"input-music",type:"file",accept:"audio/*",multiple:!0}),e.jsx("div",{onClick:()=>{ne(r)},className:"add-music",children:"+"}),e.jsx("div",{onClick:()=>{le(r)},className:"remove-music",children:"-"})]},r))}),e.jsx("div",{style:{display:x?"block":"none"},id:"add-list-music",onClick:se,children:"Adicionar"}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:l.imagem_view,className:"imagem-view",children:e.jsx("img",{className:"col-12 col-md-6",style:{width:_.width,height:_.height},src:_.src})}),e.jsx("input",{className:"file",ref:l.imagem,onChange:t=>D(t,!1),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsx("div",{className:"imagem-pt",children:e.jsx("div",{className:"imagem",onClick:()=>{l.imagem.current.click()},children:e.jsx("div",{className:"txt-1",children:O})})})]}),Y?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:l.imagem_view_premium,className:"imagem-view",children:e.jsx("img",{className:"col-12 col-md-6",style:{width:R.width,height:R.height},src:R.src})}),e.jsx("input",{className:"file",ref:l.imagem_premium,onChange:t=>D(t,!0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsx("div",{className:"imagem-pt",children:e.jsx("div",{className:"imagem",onClick:()=>{l.imagem_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:Q})})})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]}),e.jsx("div",{id:"uploadd",style:{display:V?"flex":"none"},children:e.jsx("div",{id:"uploadbd",children:e.jsxs("div",{id:"porcentagem",children:["Enviando:",G,"%"]})})}),e.jsx("div",{id:"m",style:{display:W?"flex":"none"},children:u.current?"Música alterada com sucesso.":"Música cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:z?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."}),e.jsx("div",{id:"errorCadastro",style:{display:K?"flex":"none"},children:"Adicione um arquivo de audio em todos os campos de música."})]})})}const we=i.memo(pe);export{we as default};
