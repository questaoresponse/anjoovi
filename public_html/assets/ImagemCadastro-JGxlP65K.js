import{r as i,u as ve,a as we,b as je,s as g,j as t}from"./index-B2zOBqz1.js";import{P as xe}from"./Publicar-CCpB9xyn.js";/* empty css             */const y=10000n<<18n|10000n;function He(){const x=i.useRef(!1),v=i.useRef(),F=ve(),{server:N,navigate:J,cargo:P}=F,M=we(),W={permission:i.useRef(null),descricao:i.useRef(null)},k=je(),[f,H]=i.useState([{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]),[u,_]=i.useState({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}),[G,V]=i.useState({normal:1,premium:1}),[ie,$]=i.useState(!1),[se,K]=i.useState(!1),[C,ne]=i.useState(((P.current.cargo||0)&4)==4),[B,L]=i.useState(!1),Q=e=>(e||f).filter(r=>r.src==g).length==1,ae=()=>{K(!0);const e=setTimeout(()=>{K(!1),clearTimeout(e)},2e3)},I=(e,r,n,l,c)=>{const{width:s,height:a}=c||l.refs.image_view.current.getBoundingClientRect();var m=0,h=0,o=0,d=0;if(r<n)switch(e){case 0:m=r/n*s,h=a,o=m,d=h;break;case 1:m=s,h=a,o=m,d=h;break;case 2:m=a*4/5,h=a,o=m,d=h;break;case 3:m=s,h=s*9/16,o=m,d=n/r*a}else switch(e){case 0:m=s,h=n/r*a,o=m,d=h;break;case 1:m=s,h=a,o=s,d=a;break;case 2:m=a*4/5,h=a,o=r/n*s,d=a;break;case 3:m=s,h=s*9/16,o=m,d=h}const R=BigInt(Math.floor(o/d*1e4))&(1n<<18n)-1n,b=BigInt(e)<<18n,w=o>s?1n<<20n:0n;return[R|b|w,o+"px",d+"px",m+"px",h+"px"]},X=(e,r,n)=>{const l=e.target.files[0];if(l){const c=new FileReader;c.onloadend=()=>{const s=c.result instanceof ArrayBuffer?c.result:new ArrayBuffer(0),a=new Uint8Array(s),m={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let h=null;for(const[o,d]of Object.entries(m))if(d.every((b,w)=>b===a[w])){h=o;break}if(h&&h=="jpeg"){const o=new FileReader;o.onloadend=()=>{var d="";typeof o.result=="string"?d=o.result:d=g;const R=new Image;R.src=d,R.onload=()=>{const b=Number(r?u.refs.resize.current.value:f[0].refs.resize.current.value)-1,{width:w,height:p}=R,[S,z,U,E,A]=I(b,w,p,r?u:f[n]);r?_(j=>({...j,aspect:S,elementWidth:z,elementHeight:U,imageWidth:w,imageHeight:p,width:E,height:A,filename:l.name,src:d})):H(j=>{const q=Q(j)&&j[n].src==g;return j[n]={...j[n],aspect:S,imageWidth:w,imageHeight:p,elementWidth:z,elementHeight:U,width:E,height:A,filename:l.name,src:d},q?[...j,{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]:[...j]})}},o.readAsDataURL(l)}else r?_(o=>({...o,filename:"Upload",src:g})):H(o=>(o[n]={...o[n],imageWidth:0,imageHeight:0,width:"100%",height:"100%",filename:"Upload",src:g},[...o])),e.target.value="",ae()},c.readAsArrayBuffer(l)}},O=i.useCallback(e=>{ne((e&4)==4)},[]),ce=()=>{C&&(W.permission.current.value=v.current.privado?"1":"0",L(v.current.privado))},D=i.useCallback(()=>{B&&_(e=>{if(e.src==g)return e;const r=Number(u.refs.resize.current.value)-1,[n,l,c,s,a]=I(r,e.imageWidth,e.imageHeight,e);return e.aspect=n,e.elementWidth=l,e.elementHeight=c,e.width=s,e.height=a,{...e}}),H(e=>(e=e.map(r=>{if(r.src==g)return r;const n=Number(e[0].refs.resize.current.value)-1,[l,c,s,a,m]=I(n,r.imageWidth,r.imageHeight,r);return r.aspect=l,r.elementWidth=c,r.elementHeight=s,r.width=a,r.height=m,r}),[...e]))},[]);i.useEffect(()=>{x.current=k.pathname=="/admin/imagens_edit",F.setSelected("publicar"),x.current&&M.post(N+"/admin/imagens_edit"+k.search,{type:"info"}).then(e=>{const r=e.data.post_edit;W.descricao.current.value=r.descricao,r.privado=(r.privado&2)==2,C&&(W.permission.current.value=r.privado?"1":"0"),L(r.privado),v.current=r;const n=JSON.parse(r.imagem);var l=0;const c={};for(const s of n){const a=new Image;a.src=N+"/images/"+encodeURIComponent(s),a.onload=()=>{const{width:m,height:h}=a;if(c[s]={imageWidth:m,imageHeight:h},l++,l==n.length){const{width:d,height:R}=f[0].refs.image_view.current.getBoundingClientRect(),b={width:d,height:R};var o={normal:1,premium:1};const w=n.map(p=>{const S=p.match(/^(.*)(_\d+_i).*\.webp/),z=BigInt(`0x${BigInt(parseInt(S[1],36)).toString(16)}`),U=z>>8n;if(C&&(z&1n)==1n){const Z=U>>21n<<8n|2n,ee=Z.toString(36)+S[2]+"_premium.webp",T=new Image;T.src=N+"/images/"+encodeURIComponent(ee),T.onload=()=>{const{width:te,height:re}=T;o.premium=Number(Z>>26n&(1n<<2n)-1n);const[de,ue,ge,fe,pe]=I(o.premium,te,re,f[0],b);_({aspect:de,imageWidth:te,imageHeight:re,elementWidth:ue,elementHeight:ge,width:fe,height:pe,filename:"Image.webp",src:N+"/images/"+encodeURIComponent(ee),refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}})}}o.normal=Number(U>>18n&(1n<<2n)-1n);const[E,A,j,q,he]=I(o.normal,c[p].imageWidth,c[p].imageHeight,f[0],b);return{aspect:E,imageWidth:c[p].imageWidth,imageHeight:c[p].imageHeight,elementWidth:A,elementHeight:j,width:q,height:he,filename:"Image.webp",src:N+"/images/"+encodeURIComponent(p),refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}});w.push({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}),H(w),V(o)}}}})},[]),i.useEffect(()=>(P.current.addListener(O),window.addEventListener("resize",D),()=>{P.current.removeListener(O),window.removeEventListener("resize",D)}),[O,D]),i.useEffect(()=>{v.current&&ce()},[C]);const oe=async e=>{if(e.preventDefault(),!Q())return;var n=new FormData,l=W.descricao.current.value;if(x.current)n.append("id",v.current.id.toString());else{const s=[];for(const a of f)a.src!=g&&s.push(a.refs.input.current.files.length>0?a.refs.input.current.files[0]:null);s.forEach(a=>n.append("imageFile[]",a))}if(B&&(!x.current||!v.current.privado)){const s=u.refs.input.current.files.length>0?u.refs.input.current.files[0]:null;n.append("imageFilePremium",s)}const c=[];for(const s of f)s.src!=g&&c.push(Number(s.aspect));if(n.append("type","option"),l!=""&&n.append("descricao",l),n.append("original_formats",JSON.stringify(c)),B){n.append("permission","true");const s=Number(u.aspect);s&&n.append("original_format_premium",s.toString())}M.post(N+"/admin/imagens_cadastro?type="+(x.current?"edit":"cadastro"),n,{arquivo:!0}).then(s=>{if(s.error)F.redirectError.current(s.error);else if(s.data.result=="true"){if(x.current){const m=new URLSearchParams(k.search);if(m.has("origin"))J(decodeURIComponent(m.get("origin")));else{const h=k.pathname.split("_");J(h[0]+"_lista")}x.current=!1,v.current=void 0}$(!0);var a=setTimeout(()=>{$(!1),clearInterval(a)},2e3);W.descricao.current.value="",H([{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]),_({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}})}})},le=e=>{L(e.target.value=="1")},Y=e=>{const r=Number(e?u.refs.resize.current.value:f[0].refs.resize.current.value)-1;e?_(l=>{if(l.src!=g){const[c,s,a,m,h]=I(r,l.imageWidth,l.imageHeight,l);return{...l,aspect:c,elementWidth:s,elementHeight:a,width:m,height:h}}return l}):H(l=>(l.map(c=>{if(c.src!=g){const[s,a,m,h,o]=I(r,c.imageWidth,c.imageHeight,c);c.aspect=s,c.elementWidth=a,c.elementHeight=m,c.width=h,c.height=o}return c}),[...l]));const n=e?u:f[0];V(l=>({...l,[e?"premium":"normal"]:Number(n.refs.resize.current.value)-1}))},me=e=>{H(r=>r.filter((n,l)=>l!=e||n.src==g))};return i.useEffect(()=>{if(v.current)for(const e of f)e.refs.input.current&&(e.refs.input.current.required=!1)},[f]),t.jsxs("div",{id:"pg",className:"ic",children:[t.jsxs("div",{id:"dt",className:"fechado",children:[t.jsx(xe,{}),t.jsx("div",{id:"msg1",children:"Cadastrar imagem"}),t.jsxs("form",{onSubmit:oe,children:[C?t.jsxs(t.Fragment,{children:[t.jsx("label",{children:"Disponível:"}),t.jsxs("select",{onChange:le,ref:W.permission,id:"permission",defaultValue:"0",children:[t.jsx("option",{value:"0",children:"Público"}),t.jsx("option",{value:"1",children:"Premium"})]})]}):t.jsx(t.Fragment,{}),t.jsx("label",{children:"Descrição"}),t.jsx("textarea",{ref:W.descricao}),t.jsx("label",{children:"Capa"}),t.jsx("div",{className:"image-list",children:f.map((e,r)=>t.jsxs("div",{className:"image-item",children:[t.jsx("div",{ref:e.refs.image_view,className:"imagem-view col-12 col-md-6",children:t.jsx("div",{className:"image-container",style:{width:e.width,height:e.height},children:t.jsx("img",{className:"image-img",style:{width:e.elementWidth,height:e.elementHeight},ref:e.refs.image,src:e.src})})}),t.jsx("input",{className:"file",ref:e.refs.input,onChange:n=>X(n,!1,r),type:"file",accept:"image/jpg, image/jpeg",required:r==0||r+1<f.length}),t.jsxs("div",{className:"imagem-pt",children:[t.jsx("div",{className:"imagem",onClick:()=>{e.refs.input.current.click()},children:t.jsx("div",{className:"txt-1",children:e.filename})}),t.jsxs("div",{className:"options-image",children:[t.jsxs("select",{value:String(G.normal+1),onChange:()=>r==0?Y(!1):()=>{},ref:e.refs.resize,className:"original_format"+(r>0?" disabled":""),children:[t.jsx("option",{value:"1",children:"Original"}),t.jsx("option",{value:"2",children:"1:1"}),t.jsx("option",{value:"3",children:"4:5"}),t.jsx("option",{value:"4",children:"16:9"})]}),t.jsx("div",{onClick:()=>me(r),className:"remove-image"+(r+1<f.length||e.src!=g?"":" disabled"),children:"-"})]})]})]},r))}),B?t.jsxs("div",{className:"image-item",children:[t.jsx("label",{children:"Capa borrada"}),t.jsx("div",{ref:u.refs.image_view,className:"imagem-view col-12 col-md-6",children:t.jsx("div",{className:"image-container",style:{width:u.width,height:u.height},children:t.jsx("img",{className:"image-img",style:{width:u.elementWidth,height:u.elementHeight},ref:u.refs.image,src:u.src})})}),t.jsx("input",{className:"file",ref:u.refs.input,onChange:e=>X(e,!0,0),type:"file",accept:"image/jpg, image/jpeg",required:v.current?!v.current.privado:!0}),t.jsxs("div",{className:"imagem-pt",children:[t.jsx("div",{className:"imagem",onClick:()=>{u.refs.input.current.click()},children:t.jsx("div",{className:"txt-1",children:u.filename})}),t.jsxs("select",{value:String(G.premium+1),onChange:()=>Y(!0),ref:u.refs.resize,className:"original_format",children:[t.jsx("option",{value:"1",children:"Original"}),t.jsx("option",{value:"2",children:"1:1"}),t.jsx("option",{value:"3",children:"4:5"}),t.jsx("option",{value:"4",children:"16:9"})]})]})]}):t.jsx(t.Fragment,{}),t.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),t.jsx("div",{id:"m",style:{display:ie?"flex":"none"},children:x.current?"Imagem alterada com sucesso.":"Imagem cadastrada com sucesso."}),t.jsx("div",{id:"errorImage",style:{display:se?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{He as default};
