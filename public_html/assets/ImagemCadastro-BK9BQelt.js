import{r as i,u as ve,a as we,b as je,s as g,j as r}from"./index-BKQN64Pe.js";import{P as xe}from"./Publicar-C-P23GlA.js";/* empty css             */const y=10000n<<18n|10000n;function Ne(){const x=i.useRef(!1),v=i.useRef(),P=ve(),{server:H,navigate:G,cargo:L}=P,V=we(),I={permission:i.useRef(null),descricao:i.useRef(null)},E=je(),[f,N]=i.useState([{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]),[u,_]=i.useState({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}),[$,O]=i.useState({normal:1,premium:1}),[D,K]=i.useState(!1),[se,Q]=i.useState(!1),[C,ne]=i.useState(((L.current.cargo||0)&4)==4),[S,B]=i.useState(!1),X=e=>(e||f).filter(t=>t.src==g).length==1,ae=()=>{Q(!0);const e=setTimeout(()=>{Q(!1),clearTimeout(e)},2e3)},W=(e,t,n,l,c)=>{const{width:s,height:a}=c||l.refs.image_view.current.getBoundingClientRect();var m=0,h=0,o=0,d=0;if(t<n)switch(e){case 0:m=t/n*s,h=a,o=m,d=h;break;case 1:m=s,h=a,o=m,d=n/t*a;break;case 2:m=a*4/5,h=a,o=m,d=h;break;case 3:m=s,h=s*9/16,o=m,d=n/t*a}else switch(e){case 0:m=s,h=n/t*a,o=m,d=h;break;case 1:m=s,h=a,o=t/n*s,d=a;break;case 2:m=a*4/5,h=a,o=t/n*s,d=a;break;case 3:m=s,h=s*9/16,o=m,d=h}const R=BigInt(Math.floor(o/d*1e4))&(1n<<18n)-1n,b=BigInt(e)<<18n,w=o>s?1n<<20n:0n;return[R|b|w,o+"px",d+"px",m+"px",h+"px"]},Y=(e,t,n)=>{const l=e.target.files[0];if(l){const c=new FileReader;c.onloadend=()=>{const s=c.result instanceof ArrayBuffer?c.result:new ArrayBuffer(0),a=new Uint8Array(s),m={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let h=null;for(const[o,d]of Object.entries(m))if(d.every((b,w)=>b===a[w])){h=o;break}if(h&&h=="jpeg"){const o=new FileReader;o.onloadend=()=>{var d="";typeof o.result=="string"?d=o.result:d=g;const R=new Image;R.src=d,R.onload=()=>{const b=Number(t?u.refs.resize.current.value:f[0].refs.resize.current.value)-1,{width:w,height:p}=R,[z,U,k,A,F]=W(b,w,p,t?u:f[n]);t?_(j=>({...j,aspect:z,elementWidth:U,elementHeight:k,imageWidth:w,imageHeight:p,width:A,height:F,filename:l.name,src:d})):N(j=>{const J=X(j)&&j[n].src==g;return j[n]={...j[n],aspect:z,imageWidth:w,imageHeight:p,elementWidth:U,elementHeight:k,width:A,height:F,filename:l.name,src:d},J?[...j,{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]:[...j]})}},o.readAsDataURL(l)}else t?_(o=>({...o,filename:"Upload",src:g})):N(o=>(o[n]={...o[n],imageWidth:0,imageHeight:0,width:"100%",height:"100%",filename:"Upload",src:g},[...o])),e.target.value="",ae()},c.readAsArrayBuffer(l)}},q=i.useCallback(e=>{ne((e&4)==4)},[]),ce=()=>{C&&(I.permission.current.value=v.current.privado?"1":"0",B(v.current.privado))},T=i.useCallback(()=>{S&&_(e=>{if(e.src==g)return e;const t=Number(u.refs.resize.current.value)-1,[n,l,c,s,a]=W(t,e.imageWidth,e.imageHeight,e);return e.aspect=n,e.elementWidth=l,e.elementHeight=c,e.width=s,e.height=a,{...e}}),N(e=>(e=e.map(t=>{if(t.src==g)return t;const n=Number(e[0].refs.resize.current.value)-1,[l,c,s,a,m]=W(n,t.imageWidth,t.imageHeight,t);return t.aspect=l,t.elementWidth=c,t.elementHeight=s,t.width=a,t.height=m,t}),[...e]))},[]);i.useEffect(()=>{x.current=E.pathname=="/admin/imagens_edit",P.setSelected("publicar"),x.current&&V.post(H+"/admin/imagens_edit"+E.search,{type:"info"}).then(e=>{const t=e.data.post_edit;I.descricao.current.value=t.descricao,t.privado=(t.privado&2)==2,C&&(I.permission.current.value=t.privado?"1":"0"),B(t.privado),v.current=t;const n=JSON.parse(t.imagem);var l=0;const c={};for(const s of n){const a=new Image;a.src=H+"/images/"+encodeURIComponent(s),a.onload=()=>{const{width:m,height:h}=a;if(c[s]={imageWidth:m,imageHeight:h},l++,l==n.length){const{width:d,height:R}=f[0].refs.image_view.current.getBoundingClientRect(),b={width:d,height:R};var o={normal:1,premium:1};const w=n.map(p=>{const z=p.match(/^(.*)(_\d+_i).*\.webp/),U=BigInt(`0x${BigInt(parseInt(z[1],36)).toString(16)}`),k=U>>8n;if(C&&(U&1n)==1n){const ee=k>>21n<<8n|2n,te=ee.toString(36)+z[2]+"_premium.webp",M=new Image;M.src=H+"/images/"+encodeURIComponent(te),M.onload=()=>{const{width:re,height:ie}=M;o.premium=Number(ee>>26n&(1n<<2n)-1n);const[de,ue,ge,fe,pe]=W(o.premium,re,ie,f[0],b);_({aspect:de,imageWidth:re,imageHeight:ie,elementWidth:ue,elementHeight:ge,width:fe,height:pe,filename:"Image.webp",src:H+"/images/"+encodeURIComponent(te),refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}})}}o.normal=Number(k>>18n&(1n<<2n)-1n);const[A,F,j,J,he]=W(o.normal,c[p].imageWidth,c[p].imageHeight,f[0],b);return{aspect:A,imageWidth:c[p].imageWidth,imageHeight:c[p].imageHeight,elementWidth:F,elementHeight:j,width:J,height:he,filename:"Image.webp",src:H+"/images/"+encodeURIComponent(p),refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}});w.push({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}),N(w),O(o)}}}})},[]),i.useEffect(()=>(L.current.addListener(q),window.addEventListener("resize",T),()=>{L.current.removeListener(q),window.removeEventListener("resize",T)}),[q,T]),i.useEffect(()=>{v.current&&ce()},[C]);const oe=async e=>{if(e.preventDefault(),!X())return;var n=new FormData,l=I.descricao.current.value;if(x.current)n.append("id",v.current.id.toString());else{const s=[];for(const a of f)a.src!=g&&s.push(a.refs.input.current.files.length>0?a.refs.input.current.files[0]:null);s.forEach(a=>n.append("imageFile[]",a))}if(S&&(!x.current||!v.current.privado)){const s=u.refs.input.current.files.length>0?u.refs.input.current.files[0]:null;n.append("imageFilePremium",s)}const c=[];for(const s of f)s.src!=g&&c.push(Number(s.aspect));if(n.append("type","option"),l!=""&&n.append("descricao",l),n.append("original_formats",JSON.stringify(c)),S){n.append("permission","true");const s=Number(u.aspect);s&&n.append("original_format_premium",s.toString())}V.post(H+"/admin/imagens_cadastro?type="+(x.current?"edit":"cadastro"),n,{arquivo:!0}).then(s=>{if(s.error)P.redirectError.current(s.error);else if(s.data.result=="true"){if(x.current){const m=new URLSearchParams(E.search);if(m.has("origin"))G(decodeURIComponent(m.get("origin")));else{const h=E.pathname.split("_");G(h[0]+"_lista")}x.current=!1,v.current=void 0}K(!0);var a=setTimeout(()=>{K(!1),clearInterval(a)},2e3);I.descricao.current.value="",N([{aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}]),O({normal:1,premium:1}),S&&(_({aspect:y,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:g,refs:{image_view:i.createRef(),image:i.createRef(),input:i.createRef(),resize:i.createRef()}}),B(!1))}})},le=e=>{B(e.target.value=="1")},Z=e=>{const t=Number(e?u.refs.resize.current.value:f[0].refs.resize.current.value)-1;e?_(l=>{if(l.src!=g){const[c,s,a,m,h]=W(t,l.imageWidth,l.imageHeight,l);return{...l,aspect:c,elementWidth:s,elementHeight:a,width:m,height:h}}return l}):N(l=>(l.map(c=>{if(c.src!=g){const[s,a,m,h,o]=W(t,c.imageWidth,c.imageHeight,c);c.aspect=s,c.elementWidth=a,c.elementHeight=m,c.width=h,c.height=o}return c}),[...l]));const n=e?u:f[0];O(l=>({...l,[e?"premium":"normal"]:Number(n.refs.resize.current.value)-1}))},me=e=>{N(t=>t.filter((n,l)=>l!=e||n.src==g))};return i.useEffect(()=>{if(v.current)for(const e of f)e.refs.input.current&&(e.refs.input.current.required=!1)},[f]),i.useEffect(()=>{D&&(f[0].refs.input.current.value="")},[D]),r.jsxs("div",{id:"pg",className:"ic",children:[r.jsxs("div",{id:"dt",className:"fechado",children:[r.jsx(xe,{}),r.jsx("div",{id:"msg1",children:"Cadastrar imagem"}),r.jsxs("form",{onSubmit:oe,children:[C?r.jsxs(r.Fragment,{children:[r.jsx("label",{children:"Disponível:"}),r.jsxs("select",{onChange:le,ref:I.permission,id:"permission",defaultValue:"0",children:[r.jsx("option",{value:"0",children:"Público"}),r.jsx("option",{value:"1",children:"Premium"})]})]}):r.jsx(r.Fragment,{}),r.jsx("label",{children:"Descrição"}),r.jsx("textarea",{ref:I.descricao}),r.jsx("label",{children:"Capa"}),r.jsx("div",{className:"image-list",children:f.map((e,t)=>r.jsxs("div",{className:"image-item",children:[r.jsx("div",{ref:e.refs.image_view,className:"imagem-view col-12 col-md-6",children:r.jsx("div",{className:"image-container",style:{width:e.width,height:e.height},children:r.jsx("img",{className:"image-img",style:{width:e.elementWidth,height:e.elementHeight},ref:e.refs.image,src:e.src})})}),r.jsx("input",{className:"file",ref:e.refs.input,onChange:n=>Y(n,!1,t),type:"file",accept:"image/jpg, image/jpeg",required:t==0||t+1<f.length}),r.jsxs("div",{className:"imagem-pt",children:[r.jsx("div",{className:"imagem",onClick:()=>{e.refs.input.current.click()},children:r.jsx("div",{className:"txt-1",children:e.filename})}),r.jsxs("div",{className:"options-image",children:[r.jsxs("select",{value:String($.normal+1),onChange:()=>t==0?Z(!1):()=>{},ref:e.refs.resize,className:"original_format"+(t>0?" disabled":""),children:[r.jsx("option",{value:"1",children:"Original"}),r.jsx("option",{value:"2",children:"1:1"}),r.jsx("option",{value:"3",children:"4:5"}),r.jsx("option",{value:"4",children:"16:9"})]}),r.jsx("div",{onClick:()=>me(t),className:"remove-image"+(t+1<f.length||e.src!=g?"":" disabled"),children:"-"})]})]})]},t))}),S?r.jsxs("div",{className:"image-item",children:[r.jsx("label",{children:"Capa borrada"}),r.jsx("div",{ref:u.refs.image_view,className:"imagem-view col-12 col-md-6",children:r.jsx("div",{className:"image-container",style:{width:u.width,height:u.height},children:r.jsx("img",{className:"image-img",style:{width:u.elementWidth,height:u.elementHeight},ref:u.refs.image,src:u.src})})}),r.jsx("input",{className:"file",ref:u.refs.input,onChange:e=>Y(e,!0,0),type:"file",accept:"image/jpg, image/jpeg",required:v.current?!v.current.privado:!0}),r.jsxs("div",{className:"imagem-pt",children:[r.jsx("div",{className:"imagem",onClick:()=>{u.refs.input.current.click()},children:r.jsx("div",{className:"txt-1",children:u.filename})}),r.jsxs("select",{value:String($.premium+1),onChange:()=>Z(!0),ref:u.refs.resize,className:"original_format",children:[r.jsx("option",{value:"1",children:"Original"}),r.jsx("option",{value:"2",children:"1:1"}),r.jsx("option",{value:"3",children:"4:5"}),r.jsx("option",{value:"4",children:"16:9"})]})]})]}):r.jsx(r.Fragment,{}),r.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),r.jsx("div",{id:"m",style:{display:D?"flex":"none"},children:x.current?"Imagem alterada com sucesso.":"Imagem cadastrada com sucesso."}),r.jsx("div",{id:"errorImage",style:{display:se?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{Ne as default};
