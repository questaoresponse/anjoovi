import{r as i,u as Q,a as W,b as X,s as c,j as e}from"./index-otzpnKp_.js";import{P as Y}from"./Publicar-CGTuVFlc.js";/* empty css             */function ae(){const l=i.useRef(!1),u=i.useRef(),j=Q(),{server:x,navigate:y,cargo:S}=j,C=W(),a={permission:i.useRef(null),descricao:i.useRef(null),imagem:i.useRef(null),imagem_view:i.useRef(null),image_element:i.useRef(null),original_format:i.useRef(null),imagem_premium:i.useRef(null),original_format_premium:i.useRef(null),imagem_view_premium:i.useRef(null),image_element_premium:i.useRef(null)},f=X(),[O,b]=i.useState("Upload"),[k,I]=i.useState(!1),[D,w]=i.useState(!1),[q,d]=i.useState(c),[B,N]=i.useState(c),[J,F]=i.useState("Upload"),[R,T]=i.useState(((S.current.cargo||0)&4)==4),[V,P]=i.useState(!1),G=()=>{w(!0);const s=setTimeout(()=>{w(!1),clearTimeout(s)},2e3)},U=(s,r)=>{const t=s.target.files[0];if(t){const m=new FileReader;m.onloadend=()=>{const g=m.result instanceof ArrayBuffer?m.result:new ArrayBuffer(0),v=new Uint8Array(g),h={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let o=null;for(const[n,_]of Object.entries(h))if(_.every((H,K)=>H===v[K])){o=n;break}if(o&&o=="jpeg"){r?F(t.name):b(t.name);const n=new FileReader;n.onloadend=()=>{typeof n.result=="string"?r?N(n.result):d(n.result):r?N(c):d(c)},n.readAsDataURL(t)}else r?N(c):d(c),s.target.value="",G()},m.readAsArrayBuffer(t)}},A=s=>{T((s&4)==4)},E=()=>{R&&(a.permission.current.value=u.current.privado?"1":"0",P(!0))};i.useEffect(()=>(l.current=f.pathname=="/admin/imagens_edit",j.setSelected("publicar"),l.current&&C.post(x+"/admin/imagens_edit"+f.search,{type:"info"}).then(s=>{a.imagem.current.required=!1;const r=s.data.post_edit;a.descricao.current.value=r.descricao,r.privado=(r.privado&2)==2,u.current=r,E(),d(x+"/images/"+encodeURIComponent(r.imagem))}),S.current.addListener(A),()=>{S.current.removeListener(A)}),[]),i.useEffect(()=>{u.current&&E()},[R]);const M=async s=>{s.preventDefault();var r=new FormData,t=a.descricao.current.value,m=a.imagem.current.files.length>0?a.imagem.current.files[0]:null,g=a.imagem_premium.current.files.length>0?a.imagem_premium.current.files[0]:null,v=JSON.parse(a.original_format.current.value),h=JSON.parse(a.original_format_premium.current.value);r.append("type","option"),l.current&&r.append("id",u.current.id.toString()),m&&r.append("imagem",m),g&&r.append("dImagem",g),(m||g)&&r.append("imagens_edit","true"),t!=""&&r.append("descricao",t),v&&r.append("original_format",v.toString()),h&&r.append("original_format",h.toString()),C.post(x+"/admin/imagens_cadastro?type="+(l.current?"edit":"cadastro"),r,{arquivo:!0}).then(o=>{if(o.error)j.setRedirectError(o.error);else if(o.data.result=="true"){if(l.current){const _=new URLSearchParams(f.search);if(_.has("origin"))y(decodeURIComponent(_.get("origin")));else{const L=f.pathname.split("_");y(L[0]+"_lista")}l.current=!1,u.current=void 0}I(!0);var n=setTimeout(()=>{I(!1),clearInterval(n)},2e3);a.descricao.current.value="",a.imagem.current.value="",a.original_format.current.value="true",d(c),p(!0),p(!1),F("Upload"),b("Upload")}})},z=s=>{P(s.target.value=="1")},p=s=>{const r=["rd","of"];if(s){const t=JSON.parse(a.original_format_premium.current.value);a.image_element_premium.current.classList.replace(r[+!t],r[+t])}else{const t=JSON.parse(a.original_format.current.value);a.image_element.current.classList.replace(r[+!t],r[+t])}};return e.jsxs("div",{id:"pg",className:"ic",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(Y,{}),e.jsx("div",{id:"msg1",children:"Cadastrar imagem"}),e.jsxs("form",{onSubmit:M,children:[R?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:z,ref:a.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{ref:a.descricao}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:a.imagem_view,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:a.image_element,className:"of",src:q})}),e.jsx("input",{className:"file",ref:a.imagem,onChange:s=>U(s,!1),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{a.imagem.current.click()},children:e.jsx("div",{className:"txt-1",children:O})}),e.jsxs("select",{defaultValue:"true",onChange:()=>p(!1),ref:a.original_format,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]}),V?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:a.imagem_view_premium,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:a.image_element_premium,className:"of",src:B})}),e.jsx("input",{className:"file",ref:a.imagem_premium,onChange:s=>U(s,!0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{a.imagem_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:J})}),e.jsxs("select",{defaultValue:"true",onChange:()=>p(!0),ref:a.original_format_premium,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:k?"flex":"none"},children:l.current?"Imagem alterada com sucesso.":"Imagem cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:D?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{ae as default};
