import{r as s,u as ne,a as ce,b as le,s as u,j as t}from"./index-B962sQeK.js";import{P as oe}from"./Publicar-BnXOMdMu.js";/* empty css             */const _=10000n<<18n|10000n;function ue(){const v=s.useRef(!1),j=s.useRef(),I=ne(),{server:C,navigate:U,cargo:S}=I,F=ce(),x={permission:s.useRef(null),descricao:s.useRef(null)},z=le(),[f,w]=s.useState([{aspect:_,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:u,resize:!1,refs:{image_view:s.createRef(),image:s.createRef(),input:s.createRef(),resize:s.createRef()}}]),[h,b]=s.useState({aspect:_,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:u,resize:!1,refs:{image_view:s.createRef(),image:s.createRef(),input:s.createRef(),resize:s.createRef()}}),[A,X]=s.useState({normal:1,premium:1}),[Y,P]=s.useState(!1),[Z,B]=s.useState(!1),[k,$]=s.useState(((S.current.cargo||0)&4)==4),[H,L]=s.useState(!1),O=e=>(e||f).filter(r=>r.src==u).length==1,ee=()=>{B(!0);const e=setTimeout(()=>{B(!1),clearTimeout(e)},2e3)},N=(e,r,n,l)=>{const{width:i,height:c}=l.refs.image_view.current.getBoundingClientRect();var a=0,o=0,d=0,m=0;if(r<n)switch(e){case 0:a=r/n*i,o=c,d=a,m=o;break;case 1:a=i,o=c,d=a,m=o;break;case 2:a=c*4/5,o=c,d=a,m=o;break;case 3:a=i,o=i*9/16,d=a,m=n/r*c;break}else switch(e){case 0:a=i,o=n/r*c,d=a,m=o;break;case 1:a=i,o=c,d=i,m=c;break;case 2:a=c*4/5,o=c,d=r/n*i,m=c;break;case 3:a=i,o=i*9/16,d=a,m=o}const p=BigInt(Math.floor(a/o*1e4))<<18n&(1n<<36n)-1n,R=BigInt(Math.floor(d/m*1e4))&(1n<<18n)-1n;return[p|R|(d>i?1n<<36n:0n),d+"px",m+"px",a+"px",o+"px"]},D=(e,r,n)=>{const l=e.target.files[0];if(l){const i=new FileReader;i.onloadend=()=>{const c=i.result instanceof ArrayBuffer?i.result:new ArrayBuffer(0),a=new Uint8Array(c),o={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let d=null;for(const[m,p]of Object.entries(o))if(p.every((W,y)=>W===a[y])){d=m;break}if(d&&d=="jpeg"){const m=new FileReader;m.onloadend=()=>{var p="";typeof m.result=="string"?p=m.result:p=u;const R=new Image;R.src=p,R.onload=()=>{const W=Number(r?h.refs.resize.current.value:f[0].refs.resize.current.value)-1,{width:y,height:E}=R,[J,G,V,K,Q]=N(W,y,E,r?h:f[n]);r?b(g=>({...g,aspect:J,elementWidth:G,elementHeight:V,imageWidth:y,imageHeight:E,width:K,height:Q,filename:l.name,src:p})):w(g=>{const ae=O(g)&&g[n].src==u;return g[n]={...g[n],aspect:J,imageWidth:y,imageHeight:E,elementWidth:G,elementHeight:V,width:K,height:Q,filename:l.name,src:p},ae?[...g,{aspect:_,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:u,resize:!1,refs:{image_view:s.createRef(),image:s.createRef(),input:s.createRef(),resize:s.createRef()}}]:[...g]})}},m.readAsDataURL(l)}else r?b(m=>({...m,filename:"Upload",src:u})):w(m=>(m[n]={...m[n],imageWidth:0,imageHeight:0,width:"100%",height:"100%",filename:"Upload",src:u},[...m])),e.target.value="",ee()},i.readAsArrayBuffer(l)}},q=e=>{$((e&4)==4)},te=()=>{k&&(x.permission.current.value=j.current.privado?"1":"0",L(j.current.privado))},T=()=>{H&&b(e=>{if(e.src==u)return e;const r=Number(h.refs.resize.current.value)-1,[n,l,i,c,a]=N(r,e.imageWidth,e.imageHeight,e);return e.aspect=n,e.elementWidth=l,e.elementHeight=i,e.width=c,e.height=a,{...e}}),w(e=>(e=e.map(r=>{if(r.src==u)return r;const n=Number(e[0].refs.resize.current.value)-1,[l,i,c,a,o]=N(n,r.imageWidth,r.imageHeight,r);return r.aspect=l,r.elementWidth=i,r.elementHeight=c,r.width=a,r.height=o,r}),[...e]))};s.useEffect(()=>(v.current=z.pathname=="/admin/imagens_edit",I.setSelected("publicar"),v.current&&F.post(C+"/admin/imagens_edit"+z.search,{type:"info"}).then(e=>{const r=e.data.post_edit;x.descricao.current.value=r.descricao,r.privado=(r.privado&2)==2,j.current=r;const n=JSON.parse(r.imagem);w(n.map(l=>({filename:"Image.webp",src:C+"/images/"+encodeURIComponent(l),resize:r.imagem.slice(0,2)=="r_"||r.imagem.slice(2,4)=="r_",refs:{image_view:s.createRef(),image:s.createRef(),input:s.createRef(),resize:s.createRef()}})))}),S.current.addListener(q),window.addEventListener("resize",T),()=>{S.current.removeListener(q),window.removeEventListener("resize",T)}),[]),s.useEffect(()=>{j.current&&te()},[k]);const re=async e=>{if(e.preventDefault(),!O())return;var n=new FormData,l=x.descricao.current.value;const i=[];for(const c of f)c.src!=u&&i.push(Number(c.aspect));if(v.current)n.append("id",j.current.id.toString());else{const c=[];for(const a of f)a.src!=u&&c.push(a.refs.input.current.files.length>0?a.refs.input.current.files[0]:null);if(c.forEach(a=>n.append("imageFile[]",a)),H){const a=h.refs.input.current.files.length>0?h.refs.input.current.files[0]:null;n.append("imageFilePremium",a)}}if(n.append("type","option"),l!=""&&n.append("descricao",l),n.append("original_formats",JSON.stringify(i)),H){n.append("permission","true");const c=Number(h.aspect);c&&n.append("original_format_premium",c.toString())}F.post(C+"/admin/imagens_cadastro?type="+(v.current?"edit":"cadastro"),n,{arquivo:!0}).then(c=>{if(c.error)I.redirectError.current(c.error);else if(c.data.result=="true"){if(v.current){const o=new URLSearchParams(z.search);if(o.has("origin"))U(decodeURIComponent(o.get("origin")));else{const d=z.pathname.split("_");U(d[0]+"_lista")}v.current=!1,j.current=void 0}P(!0);var a=setTimeout(()=>{P(!1),clearInterval(a)},2e3);x.descricao.current.value="",w([{aspect:_,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:u,resize:!1,refs:{image_view:s.createRef(),image:s.createRef(),input:s.createRef(),resize:s.createRef()}}]),b({aspect:_,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:u,resize:!1,refs:{image_view:s.createRef(),image:s.createRef(),input:s.createRef(),resize:s.createRef()}})}})},se=e=>{L(e.target.value=="1")},M=e=>{const r=Number(e?h.refs.resize.current.value:f[0].refs.resize.current.value)-1;e?b(l=>{if(l.src!=u){const[i,c,a,o,d]=N(r,l.imageWidth,l.imageHeight,l);return{...l,aspect:i,elementWidth:c,elementHeight:a,width:o,height:d}}return l}):w(l=>(l.map(i=>{if(i.src!=u){const[c,a,o,d,m]=N(r,i.imageWidth,i.imageHeight,i);i.aspect=c,i.elementWidth=a,i.elementHeight=o,i.width=d,i.height=m}return i}),[...l]));const n=e?h:f[0];X(l=>({...l,[e?"premium":"normal"]:Number(n.refs.resize.current.value)-1}))},ie=e=>{w(r=>r.filter((n,l)=>l!=e||n.src==u))};return s.useEffect(()=>{if(j.current)for(const e of f)e.refs.input.current&&(e.refs.input.current.required=!1)},[f]),t.jsxs("div",{id:"pg",className:"ic",children:[t.jsxs("div",{id:"dt",className:"fechado",children:[t.jsx(oe,{}),t.jsx("div",{id:"msg1",children:"Cadastrar imagem"}),t.jsxs("form",{onSubmit:re,children:[k?t.jsxs(t.Fragment,{children:[t.jsx("label",{children:"Disponível:"}),t.jsxs("select",{onChange:se,ref:x.permission,id:"permission",defaultValue:"0",children:[t.jsx("option",{value:"0",children:"Público"}),t.jsx("option",{value:"1",children:"Premium"})]})]}):t.jsx(t.Fragment,{}),t.jsx("label",{children:"Descrição"}),t.jsx("textarea",{ref:x.descricao}),t.jsx("label",{children:"Capa"}),t.jsx("div",{className:"image-list",children:f.map((e,r)=>t.jsxs("div",{className:"image-item",children:[t.jsx("div",{ref:e.refs.image_view,className:"imagem-view col-12 col-md-6",children:t.jsx("div",{className:"image-container",style:{width:e.width,height:e.height},children:t.jsx("img",{className:"image-img",style:{width:e.elementWidth,height:e.elementHeight},ref:e.refs.image,src:e.src})})}),t.jsx("input",{className:"file",ref:e.refs.input,onChange:n=>D(n,!1,r),type:"file",accept:"image/jpg, image/jpeg",required:r==0||r+1<f.length}),t.jsxs("div",{className:"imagem-pt",children:[t.jsx("div",{className:"imagem",onClick:()=>{e.refs.input.current.click()},children:t.jsx("div",{className:"txt-1",children:e.filename})}),t.jsxs("div",{className:"options-image",children:[t.jsxs("select",{value:String(A.normal+1),onChange:()=>r==0?M(!1):()=>{},ref:e.refs.resize,className:"original_format"+(r>0?" disabled":""),children:[t.jsx("option",{value:"1",children:"Original"}),t.jsx("option",{value:"2",children:"1:1"}),t.jsx("option",{value:"3",children:"4:5"}),t.jsx("option",{value:"4",children:"16:9"})]}),t.jsx("div",{onClick:()=>ie(r),className:"remove-image"+(r+1<f.length||e.src!=u?"":" disabled"),children:"-"})]})]})]},r))}),H?t.jsxs("div",{className:"image-item",children:[t.jsx("label",{children:"Capa borrada"}),t.jsx("div",{ref:h.refs.image_view,className:"imagem-view col-12 col-md-6",children:t.jsx("div",{className:"image-container",style:{width:h.width,height:h.height},children:t.jsx("img",{className:"image-img",style:{width:h.elementWidth,height:h.elementHeight},ref:h.refs.image,src:h.src})})}),t.jsx("input",{className:"file",ref:h.refs.input,onChange:e=>D(e,!0,0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),t.jsxs("div",{className:"imagem-pt",children:[t.jsx("div",{className:"imagem",onClick:()=>{h.refs.input.current.click()},children:t.jsx("div",{className:"txt-1",children:h.filename})}),t.jsxs("select",{value:String(A.premium+1),onChange:()=>M(!0),ref:h.refs.resize,className:"original_format",children:[t.jsx("option",{value:"1",children:"Original"}),t.jsx("option",{value:"2",children:"1:1"}),t.jsx("option",{value:"3",children:"4:5"}),t.jsx("option",{value:"4",children:"16:9"})]})]})]}):t.jsx(t.Fragment,{}),t.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),t.jsx("div",{id:"m",style:{display:Y?"flex":"none"},children:v.current?"Imagem alterada com sucesso.":"Imagem cadastrada com sucesso."}),t.jsx("div",{id:"errorImage",style:{display:Z?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{ue as default};
