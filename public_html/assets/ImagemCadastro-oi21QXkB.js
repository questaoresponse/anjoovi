import{r as i,u as Q,a as W,b as X,s as c,j as e}from"./index-ChwaHiiT.js";import{P as Y}from"./Publicar-Buo43mLR.js";/* empty css             */function ae(){const m=i.useRef(!1),u=i.useRef(),j=Q(),{server:x,navigate:R,cargo:S}=j,C=W(),a={permission:i.useRef(null),descricao:i.useRef(null),imagem:i.useRef(null),imagem_view:i.useRef(null),image_element:i.useRef(null),original_format:i.useRef(null),imagem_premium:i.useRef(null),original_format_premium:i.useRef(null),imagem_view_premium:i.useRef(null),image_element_premium:i.useRef(null)},p=X(),[k,b]=i.useState("Upload"),[D,I]=i.useState(!1),[q,w]=i.useState(!1),[B,d]=i.useState(c),[J,N]=i.useState(c),[T,F]=i.useState("Upload"),[y,V]=i.useState(((S.current.cargo||0)&4)==4),[P,U]=i.useState(!1),G=()=>{w(!0);const s=setTimeout(()=>{w(!1),clearTimeout(s)},2e3)},A=(s,r)=>{const t=s.target.files[0];if(t){const l=new FileReader;l.onloadend=()=>{const h=l.result instanceof ArrayBuffer?l.result:new ArrayBuffer(0),g=new Uint8Array(h),f={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let o=null;for(const[n,_]of Object.entries(f))if(_.every((H,K)=>H===g[K])){o=n;break}if(o&&o=="jpeg"){r?F(t.name):b(t.name);const n=new FileReader;n.onloadend=()=>{typeof n.result=="string"?r?N(n.result):d(n.result):r?N(c):d(c)},n.readAsDataURL(t)}else r?N(c):d(c),s.target.value="",G()},l.readAsArrayBuffer(t)}},E=s=>{V((s&4)==4)},L=()=>{y&&(a.permission.current.value=u.current.privado?"1":"0",U(!0))};i.useEffect(()=>(m.current=p.pathname=="/admin/imagens_edit",j.setSelected("publicar"),m.current&&C.post(x+"/admin/imagens_edit"+p.search,{type:"info"}).then(s=>{a.imagem.current.required=!1;const r=s.data.post_edit;a.descricao.current.value=r.descricao,r.privado=(r.privado&2)==2,u.current=r,L(),d(x+"/images/"+encodeURIComponent(r.imagem))}),S.current.addListener(E),()=>{S.current.removeListener(E)}),[]),i.useEffect(()=>{u.current&&L()},[y]);const M=async s=>{s.preventDefault();var r=new FormData,t=a.descricao.current.value,l=JSON.parse(a.original_format.current.value),h=a.original_format_premium.current?JSON.parse(a.original_format_premium.current.value):null,g=a.imagem.current.files.length>0?a.imagem.current.files[0]:null,f=a.imagem_premium.current&&a.imagem_premium.current.files.length>0?a.imagem_premium.current.files[0]:null;r.append("type","option"),m.current&&r.append("id",u.current.id.toString()),g&&r.append("imagem",g),f&&r.append("dImagem",f),(g||f)&&r.append("imagens_edit","true"),t!=""&&r.append("descricao",t),l&&r.append("original_format",l.toString()),h&&r.append("original_format",h.toString()),C.post(x+"/admin/imagens_cadastro?type="+(m.current?"edit":"cadastro"),r,{arquivo:!0}).then(o=>{if(o.error)j.redirectError.current(o.error);else if(o.data.result=="true"){if(m.current){const _=new URLSearchParams(p.search);if(_.has("origin"))R(decodeURIComponent(_.get("origin")));else{const O=p.pathname.split("_");R(O[0]+"_lista")}m.current=!1,u.current=void 0}I(!0);var n=setTimeout(()=>{I(!1),clearInterval(n)},2e3);a.descricao.current.value="",a.imagem.current.value="",a.original_format.current.value="true",d(c),P&&v(!0),v(!1),F("Upload"),b("Upload")}})},z=s=>{U(s.target.value=="1")},v=s=>{const r=["rd","of"];if(s){const t=JSON.parse(a.original_format_premium.current.value);a.image_element_premium.current.classList.replace(r[+!t],r[+t])}else{const t=JSON.parse(a.original_format.current.value);a.image_element.current.classList.replace(r[+!t],r[+t])}};return e.jsxs("div",{id:"pg",className:"ic",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(Y,{}),e.jsx("div",{id:"msg1",children:"Cadastrar imagem"}),e.jsxs("form",{onSubmit:M,children:[y?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:z,ref:a.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{ref:a.descricao}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:a.imagem_view,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:a.image_element,className:"of",src:B})}),e.jsx("input",{className:"file",ref:a.imagem,onChange:s=>A(s,!1),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{a.imagem.current.click()},children:e.jsx("div",{className:"txt-1",children:k})}),e.jsxs("select",{defaultValue:"true",onChange:()=>v(!1),ref:a.original_format,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]}),P?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:a.imagem_view_premium,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:a.image_element_premium,className:"of",src:J})}),e.jsx("input",{className:"file",ref:a.imagem_premium,onChange:s=>A(s,!0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{a.imagem_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:T})}),e.jsxs("select",{defaultValue:"true",onChange:()=>v(!0),ref:a.original_format_premium,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:D?"flex":"none"},children:m.current?"Imagem alterada com sucesso.":"Imagem cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:q?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{ae as default};
