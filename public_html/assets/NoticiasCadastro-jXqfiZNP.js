import{r as c,u as me,a as ce,c as oe,b as ue,s as x,j as e}from"./index-BG8pJWrf.js";import{P as de}from"./Publicar-mZkAMyGt.js";/* empty css             */const z=10000n<<18n|10000n;function fe(){const v=c.useRef(!1),I=c.useRef(),W=me(),{server:j,cargo:A}=W,q=ce(),D=oe(),r={permission:c.useRef(null),titulo:c.useRef(null),subtitulo:c.useRef(null),textarea:c.useRef(null),input:c.useRef(null),resize:c.useRef(null),image_view:c.useRef(null),image_element:c.useRef(null),image_premium:c.useRef(null),resize_premium:c.useRef(null),image_view_premium:c.useRef(null),image_element_premium:c.useRef(null)},S=ue(),[g,R]=c.useState({aspect:z,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:x}),[p,y]=c.useState({aspect:z,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:x}),[F,M]=c.useState({normal:0,premium:0}),[Q,G]=c.useState(!1),[X,J]=c.useState(!1),[H,Y]=c.useState(((A.current.cargo||0)&4)==4),[B,E]=c.useState(!1),Z=()=>{J(!0);const t=setTimeout(()=>{J(!1),clearTimeout(t)},2e3)},w=(t,i,o)=>{const{width:a,height:l}=r.image_view.current.getBoundingClientRect();var n=0,s=0,m=0,u=0;if(i<o)switch(t){case 0:n=i/o*a,s=l,m=n,u=s;break;case 1:n=a,s=l,m=n,u=o/i*l;break;case 2:n=l*4/5,s=l,m=n,u=s;break;case 3:n=a,s=a*9/16,m=n,u=o/i*l}else switch(t){case 0:n=a,s=o/i*l,m=n,u=s;break;case 1:n=a,s=l,m=i/o*a,u=l;break;case 2:n=l*4/5,s=l,m=i/o*a,u=l;break;case 3:n=a,s=a*9/16,m=n,u=s}const d=BigInt(Math.floor(m/u*1e4))&(1n<<18n)-1n;return[BigInt(t)<<18n|d,m+"px",u+"px",n+"px",s+"px"]},V=(t,i)=>{const o=t.target.files[0];if(o){const a=new FileReader;a.onloadend=()=>{const l=a.result instanceof ArrayBuffer?a.result:new ArrayBuffer(0),n=new Uint8Array(l),s={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let m=null;for(const[h,f]of Object.entries(s))if(f.every((_,N)=>_===n[N])){m=h;break}const u=i?F.premium:F.normal,d=i?y:R;if(m&&m=="jpeg"){const h=new FileReader;h.onloadend=()=>{var f="";typeof h.result=="string"?f=h.result:f=x;const b=new Image;b.src=f,b.onload=()=>{const{width:_,height:N}=b,[T,k,U,C,P]=w(u,_,N);d({aspect:T,elementWidth:k,elementHeight:U,imageWidth:_,imageHeight:N,width:C,height:P,filename:o.name,src:f})}},h.readAsDataURL(o)}else d(h=>({...h,filename:"Upload",src:x})),t.target.value="",Z()},a.readAsArrayBuffer(o)}};v.current=S.pathname=="/admin/noticias_edit";const L=c.useCallback(t=>{Y((t&4)==4)},[]),ee=()=>{H&&(r.permission.current.value=I.current.privado?"1":"0",E(!0))},O=c.useCallback(()=>{B&&y(t=>{if(t.src==x)return t;const i=Number(r.resize_premium.current.value)-1,[o,a,l,n,s]=w(i,t.imageWidth,t.imageHeight);return t.aspect=o,t.elementWidth=a,t.elementHeight=l,t.width=n,t.height=s,{...t}}),R(t=>{if(t.src==x)return t;const i=Number(r.resize.current.value)-1,[o,a,l,n,s]=w(i,t.imageWidth,t.imageHeight);return t.aspect=o,t.elementWidth=a,t.elementHeight=l,t.width=n,t.height=s,t})},[]);c.useEffect(()=>{W.setSelected("publicar"),v.current&&q.post(j+"/admin/noticias_edit"+S.search,{type:"info"}).then(t=>{if("post_edit"in t.data){r.input.current.required=!1;const i=t.data.post_edit[0];r.titulo.current.value=i.titulo,r.subtitulo.current.value=i.subtitulo,r.textarea.current.value=i.texto,i.privado=(i.privado&2)==2,H&&(r.permission.current.value=i.privado?"1":"0"),E(i.privado),I.current=i;const o=JSON.parse(i.imagem);for(const a of o){const l=new Image;l.src=j+"/images/"+encodeURIComponent(a),l.onload=()=>{const{width:n,height:s}=l;var m={normal:0,premium:0};const u=a.match(/^(.*)(_\d+_i).*\.webp/),d=BigInt(`0x${BigInt(parseInt(u[1],36)).toString(16)}`),h=d>>8n;if(H&&(d&1n)==1n){const k=h>>21n<<8n|2n,U=k.toString(36)+u[2]+"_premium.webp",C=new Image;C.src=j+"/images/"+encodeURIComponent(U),C.onload=()=>{const{width:P,height:K}=C;m.premium=Number(k>>26n&(1n<<2n)-1n);const[re,ne,ae,se,le]=w(m.premium,P,K);y({aspect:re,imageWidth:P,imageHeight:K,elementWidth:ne,elementHeight:ae,width:se,height:le,filename:"Image.webp",src:j+"/images/"+encodeURIComponent(U)})}}m.normal=Number(h>>18n&(1n<<2n)-1n);const[f,b,_,N,T]=w(m.normal,n,s);R({aspect:f,imageWidth:n,imageHeight:s,elementWidth:b,elementHeight:_,width:N,height:T,filename:"Image.webp",src:j+"/images/"+encodeURIComponent(a)}),M(m)}}}})},[]),c.useEffect(()=>(A.current.addListener(L),window.addEventListener("resize",O),()=>{A.current.removeListener(L),window.removeEventListener("resize",O)}),[L,O]),c.useEffect(()=>{I.current&&ee()},[H]);const te=async t=>{t.preventDefault();var i=new FormData;const o=r.titulo.current.value,a=r.subtitulo.current.value,l=r.textarea.current.value;var n=r.input.current.files.length>0?r.input.current.files[0]:null,s=r.image_premium.current&&r.image_premium.current.files.length>0?r.image_premium.current.files[0]:null;i.append("type","option"),v.current&&i.append("id",I.current.id.toString()),v.current&&(n||s)&&i.append("imagens_edit","true"),r.permission.current&&i.append("permission",r.permission.current.value),i.append("usuario",W.login.usuario),i.append("titulo",o),i.append("texto",l),a!=""&&i.append("subtitulo",a),i.append("original_format",Number(g.aspect).toString()),n&&i.append("imageFile",n),B&&(i.append("original_format_premium",Number(p.aspect).toString()),i.append("imageFilePremium",s)),q.post(j+"/admin/noticias_cadastro?type="+(v.current?"edit":"cadastro"),i,{arquivo:!0}).then(m=>{if(m.error)W.redirectError.current(m.error);else if(m.data.result=="true"){if(v.current){const d=new URLSearchParams(S.search);if(d.has("origin"))D(decodeURIComponent(d.get("origin")));else{const h=S.pathname.split("_");D(h[0]+"_lista")}v.current=!1,I.current=void 0}G(!0);var u=setTimeout(()=>{G(!1),clearInterval(u)},2e3);r.titulo.current.value="",r.subtitulo.current.value="",r.textarea.current.value="",r.input.current.value="",R({aspect:z,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:x}),y({aspect:z,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:x})}})},ie=t=>{E(t.target.value=="1")},$=t=>{const[i,o,a]=t?[Number(r.resize_premium.current.value),p.imageWidth,p.imageHeight]:[Number(r.resize.current.value),g.imageWidth,g.imageHeight],[l,n,s,m,u]=w(i-1,o,a);(t?y:R)(d=>({...d,aspect:l,elementWidth:n,elementHeight:s,width:m,height:u})),M(d=>({...d,[t?"premium":"normal"]:i}))};return e.jsxs("div",{id:"pg",className:"nc",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(de,{}),e.jsx("div",{id:"msg1",children:"Cadastrar matéria"}),e.jsxs("form",{onSubmit:te,children:[H?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:ie,ref:r.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Título"}),e.jsx("input",{ref:r.titulo,className:"input",id:"titulo",placeholder:"Insira um título",required:!0}),e.jsx("label",{children:"Subtítulo"}),e.jsx("input",{ref:r.subtitulo,className:"input",id:"subtitulo",placeholder:"Insira um subtítulo"}),e.jsx("label",{children:"Texto"}),e.jsx("textarea",{ref:r.textarea}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:r.image_view,className:"imagem-view col-12 col-md-6",children:e.jsx("div",{className:"image-container",style:{width:g.width,height:g.height},children:e.jsx("img",{className:"image-img",style:{width:g.elementWidth,height:g.elementHeight},ref:r.image_element,src:g.src})})}),e.jsx("input",{className:"file",ref:r.input,onChange:t=>V(t,!1),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{r.input.current.click()},children:e.jsx("div",{className:"txt-1",children:g.filename})}),e.jsxs("select",{value:String(F.normal+1),onChange:()=>$(!1),ref:r.resize,className:"original_format",children:[e.jsx("option",{value:"1",children:"Original"}),e.jsx("option",{value:"2",children:"1:1"}),e.jsx("option",{value:"3",children:"4:5"}),e.jsx("option",{value:"4",children:"16:9"})]})]})]}),B?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:r.image_view_premium,className:"imagem-view col-12 col-md-6",children:e.jsx("div",{className:"image-container",style:{width:p.width,height:p.height},children:e.jsx("img",{className:"image-img",style:{width:p.elementWidth,height:p.elementHeight},ref:r.image_element,src:p.src})})}),e.jsx("input",{className:"file",ref:r.image_premium,onChange:t=>V(t,!0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{r.image_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:p.filename})}),e.jsxs("select",{value:String(F.premium+1),onChange:()=>$(!0),ref:r.resize_premium,className:"original_format",children:[e.jsx("option",{value:"1",children:"Original"}),e.jsx("option",{value:"2",children:"1:1"}),e.jsx("option",{value:"3",children:"4:5"}),e.jsx("option",{value:"4",children:"16:9"})]})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:Q?"flex":"none"},children:v.current?"Matéria alterada com sucesso.":"Matéria cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:X?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{fe as default};
