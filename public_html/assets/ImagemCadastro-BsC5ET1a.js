import{r as t,u as B,a as D,b as L,s as f,j as e}from"./index-Ch3-YxzV.js";import{P as T}from"./Publicar--6s-ICn1.js";/* empty css             */function G(){const o=t.useRef(!1),p=t.useRef(),v=B(),{server:h,navigate:x}=v,_=D(),r={descricao:t.useRef(null),imagem:t.useRef(null),imagem_view:t.useRef(null),image_element:t.useRef(null),original_format:t.useRef(null)},u=L(),[C,y]=t.useState("Upload"),[I,S]=t.useState(!1),[w,R]=t.useState(!1),A=()=>{R(!0);const s=setTimeout(()=>{R(!1),clearTimeout(s)},2e3)},[N,c]=t.useState(f),E=s=>{const a=s.target.files[0];if(a){const n=new FileReader;n.onloadend=()=>{const l=n.result instanceof ArrayBuffer?n.result:new ArrayBuffer(0),g=new Uint8Array(l),m={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let d=null;for(const[i,j]of Object.entries(m))if(j.every((F,O)=>F===g[O])){d=i;break}if(d&&d=="jpeg"){y(a.name);const i=new FileReader;i.onloadend=()=>{typeof i.result=="string"?c(i.result):c(f)},i.readAsDataURL(a)}else c(f),s.target.value="",A()},n.readAsArrayBuffer(a)}};t.useEffect(()=>{o.current=u.pathname=="/admin/imagens_edit",v.setSelected("publicar"),o.current&&_.post(h+"/admin/imagens_edit"+u.search,{type:"info"}).then(s=>{r.imagem.current.required=!1;const a=s.data.post_edit;r.descricao.current.value=a.descricao,p.current=a,c(h+"/images/"+encodeURIComponent(a.imagem))})},[]);const U=async s=>{s.preventDefault();var a=new FormData,n=r.descricao.current.value,l=r.imagem.current.files.length>0?r.imagem.current.files[0]:null,g=JSON.parse(r.original_format.current.value);a.append("type","option"),o.current&&a.append("id",p.current.id.toString()),l&&a.append("imagem",l),l&&a.append("imagens_edit","true"),n!=""&&a.append("descricao",n),g&&a.append("original_format",g.toString()),_.post(h+"/admin/imagens_cadastro?type="+(o.current?"edit":"cadastro"),a,{arquivo:!0}).then(m=>{if(m.error)v.setRedirectError(m.error);else if(m.data.result=="true"){if(o.current){const i=new URLSearchParams(u.search);if(i.has("origin"))x(decodeURIComponent(i.get("origin")));else{const j=u.pathname.split("_");x(j[0]+"_lista")}o.current=!1,p.current=void 0}S(!0);var d=setTimeout(()=>{S(!1),clearInterval(d)},2e3);r.descricao.current.value="",r.imagem.current.value="",r.original_format.current.value="true",c(f),b(),y("Upload")}})},b=()=>{const s=["rd","of"],a=JSON.parse(r.original_format.current.value);r.image_element.current.classList.replace(s[+!a],s[+a])};return e.jsxs("div",{id:"pg",className:"ic",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(T,{}),e.jsx("div",{id:"msg1",children:"Cadastrar imagem"}),e.jsxs("form",{onSubmit:U,children:[e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{ref:r.descricao}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{id:"imagem-div",children:[e.jsx("div",{ref:r.imagem_view,id:"imagem-view",className:"col-12 col-md-6",children:e.jsx("img",{ref:r.image_element,className:"of",src:N})}),e.jsx("input",{className:"file",ref:r.imagem,onChange:E,type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{id:"imagem-pt",children:[e.jsx("div",{id:"imagem",onClick:()=>{r.imagem.current.click()},children:e.jsx("div",{className:"txt-1",children:C})}),e.jsxs("select",{defaultValue:"true",onChange:b,ref:r.original_format,id:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:I?"flex":"none"},children:o.current?"Imagem alterada com sucesso.":"Imagem cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:w?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{G as default};
