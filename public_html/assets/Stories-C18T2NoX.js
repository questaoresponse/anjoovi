import{R as $,u as ce,a as ae,b as ue,r as e,j as t}from"./index-D2cLP4Ja.js";function ie(){const S=ce(),{navigate:D,firstPageInfos:q}=S,j=S.server,L=ae(),h=ue(),B=e.useRef(null),[oe,H]=e.useState(),k=e.useRef(),J=r=>{k.current=r,H(r)},[E,C]=e.useState("play"),[K,Q]=e.useState(),[f,W]=e.useState({src:null,type:""}),[o,X]=e.useState(!q.current.isFirstPage),u=e.useRef(null),n=e.useRef(0),R=e.useRef(0),c=e.useRef([]),b=e.useRef(!0),g=e.useRef(!1),l=e.useRef(!0),w=e.useRef(),I=e.useRef(),x=e.useRef(),[F,Y]=e.useState(!1),i={video:e.useRef(null)},T=e.useCallback(()=>{var r=new URLSearchParams(h.search);return r.has("origin")?r.get("origin"):"/"},[h.search]),A=e.useCallback(()=>{clearInterval(u.current),D(T())},[u.current]),Z=e.useCallback(r=>{b.current||L.post(j+"/stories/"+r,{type:"option"}).then(s=>{s.error&&(console.log(s.error),S.setRedirectError(s.error))})},[b.current]),_=e.useRef(!1);e.useCallback(async(r=!1)=>{if(!(r&&_.current)){r&&!_.current&&(_.current=!0);var s=await L.post(j+h.pathname,{type:"info"});if(s.error)console.log(s.error),S.setRedirectError(s.error);else{I.current=Number(h.pathname.split("/")[2]),n.current=s.data.posts.findIndex(P=>P.id===I.current),x.current=n.current,J(s.data.posts);for(var a of s.data.posts)c.current.push({a:$.createRef(),i:a.filename,type:a.type,id:a.id}),Y(!0)}}},[])(!0),e.useEffect(()=>{F&&o&&d()},[F,o]);function p(r,s){r.className=s}function v(r,s,a){r.style[s]=a}const ee=r=>{if(k.current){const s=Number(h.pathname.split("/")[2]),a=k.current.findIndex(P=>P.id===s);x.current+1>a&&x.current==1?A():x.current+1>a?U(!0):z(!0)}},V=()=>{ee(new Date().toISOString())};e.useEffect(()=>(window.addEventListener("popstate",V),()=>{window.removeEventListener("popstate",V)}),[]);const N=e.useRef(null),m=()=>c.current[n.current-1].a.current,y=e.useRef(1e4),d=e.useCallback((r=!1)=>{if(c.current.length!=n.current){const s=c.current[n.current].type;W({src:j+(s=="mp4"?"/videos/":"/images/")+c.current[n.current].i,type:s}),s!="mp4"&&(y.current=1e4);const a=()=>{l.current&&(l.current=!1,g.current=!0,C("play")),w.current=new Date,n.current>0&&p(m(),"a2 end_animation"),p(c.current[n.current].a.current,"a2 animation"),!r&&x.current!=0&&window.history.pushState(null,null,"/stories/"+c.current[n.current].id+h.search),Z(c.current[n.current].id),b.current=!1,n.current++,x.current=n.current,c.current.length>n.current&&Q(j+"/images/"+encodeURIComponent(c.current[n.current].i)),g.current&&(g.current=!1),clearInterval(u.current),u.current=setInterval(()=>{d()},y.current),R.current=0};s=="mp4"?N.current=a:a()}else clearInterval(u.current),D(T())},[c.current,n.current,l.current,g,u.current,R.current,b.current]),z=e.useCallback((r=!1)=>{n.current>0&&(p(m(),"a2 end_animation"),v(m(),"animationPlayState","running")),clearInterval(u.current),d(r)},[c.current,n.current,u.current]),U=e.useCallback((r=!1)=>{n.current>2?(p(m(),"a2 init_animation"),v(m(),"animationPlayState","running"),p(c.current[n.current-2].a.current,"a2 init_animation"),v(c.current[n.current-2].a.current,"animationPlayState","running"),n.current-=2,d(r),clearInterval(u.current),u.current=setInterval(()=>{d()},y.current)):n.current<=2&&n.current>1&&(p(c.current[1].a.current,"a2 init_animation"),v(c.current[1].a.current,"animationPlayState","running"),p(c.current[0].a.current,"a2 init_animation"),v(c.current[0].a.current,"animationPlayState","running"),n.current=0,d(),clearInterval(u.current),u.current=setInterval(()=>{d()},y.current))},[n.current]),re=e.useCallback(()=>{z()},[]),te=e.useCallback(()=>{U()},[]),G=e.useCallback(()=>{if(o){if(l.current)return;C("pause"),l.current=!0,clearInterval(u.current);var r=new Date;R.current+=r.getTime()-w.current.getTime(),v(m(),"animationPlayState","paused"),f.type=="mp4"&&i.video.current&&i.video.current.pause()}},[f.type,n.current,l.current,w.current]),M=()=>{if(o){if(!l.current)return;C("play"),l.current=!1,g.current=!0,v(m(),"animationPlayState","running");var r=y.current-R.current;u.current=setInterval(()=>{d()},r),w.current=new Date,f.type=="mp4"&&i.video.current&&i.video.current.play()}},[ne,se]=e.useState(15),O=e.useCallback((r,s=!1)=>{if(i.video.current){const a=i.video.current.duration>15?15e3:i.video.current.duration*1e3;a!=y.current&&(y.current=a,se(i.video.current.duration>15?15:i.video.current.duration))}(o||s)&&(i.video.current.play(),N.current(),N.current=null)},[o]);return t.jsxs("div",{id:"pg",className:"w-100 st",style:{height:"100vh"},children:[t.jsx("div",{id:"c",className:"d-flex justify-content-center w-100 h-100",children:t.jsxs("div",{id:"filed",onTouchStart:G,onTouchEnd:M,className:"h-100",children:[f.src?f.type=="mp4"?t.jsx("video",{style:{display:o?"block":"none"},onLoadedMetadata:O,ref:i.video,src:f.src,id:"s_file"}):t.jsx("img",{src:f.src,id:"s_file"}):t.jsx(t.Fragment,{}),t.jsx("div",{id:"a"}),t.jsx("div",{id:"ls",onClick:te}),t.jsx("div",{id:"ld",onClick:re}),o?t.jsx(t.Fragment,{}):t.jsx("div",{id:"menuShowStory",children:t.jsxs("div",{id:"showStory-content",children:[t.jsx("div",{id:"showStory-label",children:"Deseja ver esse story?"}),t.jsx("div",{id:"btnShowStory",onClick:()=>{X(!0),O("",!0)},children:"Ver story"})]})}),t.jsxs("div",{id:"xd",className:"d-none d-md-block",children:[t.jsx("div",{id:"x1",onClick:G,style:{display:E==="play"?"flex":"none"},children:t.jsx("i",{id:"",className:"bi-pause-fill ef",style:{fontSize:"40px"}})}),t.jsx("div",{id:"x2",onClick:M,style:{display:E==="play"?"none":"flex"},children:t.jsx("i",{id:"",className:"bi-play-fill ef",style:{fontSize:"40px"}})})]})]})}),t.jsx("div",{ref:B,id:"status_div",children:c.current.map((r,s)=>{var a="";return I.current>r.id&&(a=" end_animation"),t.jsxs("div",{className:"status_a",style:{width:95/c.current.length+"%",marginLeft:"0.1%"},children:[t.jsx("div",{className:"a1"}),t.jsx("div",{ref:c.current[s].a,className:"a2"+a,style:{animationDuration:ne+"s"}})]},s)})}),t.jsx("div",{onClick:A,id:"x",children:t.jsx("i",{className:"bi-x"})}),t.jsx("img",{id:"cg",src:K,style:{display:"none"}})]})}const fe=$.memo(ie);export{fe as default};
