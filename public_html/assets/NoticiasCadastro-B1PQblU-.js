import{r as i,u as B,a as D,c as L,b as k,s as S,j as a}from"./index-bSiPObUC.js";import{P as M}from"./Publicar-BPvfgFND.js";/* empty css             */function W(){const u=i.useRef(!1),h=i.useRef(),m=B(),v=m.server,x=D(),j=L(),t={titulo:i.useRef(null),subtitulo:i.useRef(null),textarea:i.useRef(null),imagem:i.useRef(null),original_format:i.useRef(null),imagem_view:i.useRef(null),image_element:i.useRef(null)},g=k(),[I,_]=i.useState("Upload"),[N,b]=i.useState(!1),[C,w]=i.useState(!1),A=()=>{w(!0);const r=setTimeout(()=>{w(!1),clearTimeout(r)},2e3)},[E,y]=i.useState({src:S,width:"100%",height:"100%"}),f=r=>{if(typeof r=="string"){const e=new Image;e.onload=()=>{const n=t.imagem_view.current.offsetWidth,l=t.imagem_view.current.offsetHeight;var o=e.width,s=e.height;n/o*s>l?(o=l/s*o,s=l):(s=n/o*s,o=n),y({src:r,width:o,height:s})},e.src=r}else y({src:S,width:window.innerWidth,height:window.innerHeight/1280*720})},U=r=>{const e=r.target.files[0];if(e){const n=new FileReader;n.onloadend=()=>{const l=n.result instanceof ArrayBuffer?n.result:new ArrayBuffer(0),o=new Uint8Array(l),s={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let c=null;for(const[d,p]of Object.entries(s))if(p.every((O,q)=>O===o[q])){c=d;break}if(c&&c=="jpeg"){_(e.name);const d=new FileReader;d.onloadend=()=>{f(d.result)},d.readAsDataURL(e)}else f(null),r.target.value="",A()},n.readAsArrayBuffer(e)}};u.current=g.pathname=="/admin/noticias_edit",i.useEffect(()=>{m.setSelected("publicar"),u.current&&x.post(v+"/admin/noticias_edit"+g.search,{type:"info"}).then(r=>{if("post_edit"in r.data){t.imagem.current.required=!1;const e=r.data.post_edit[0];t.titulo.current.value=e.titulo,t.subtitulo.current.value=e.subtitulo,t.textarea.current.value=e.texto,h.current=e,f(v+"/images/"+encodeURIComponent(e.imagem))}})},[]);const F=async r=>{r.preventDefault();var e=new FormData,n=t.titulo.current.value,l=t.subtitulo.current.value,o=JSON.parse(t.original_format.current.value),s=t.imagem.current.files.length>0?t.imagem.current.files[0]:null;e.append("type","option"),u.current&&e.append("id",h.current.id.toString()),s&&e.append("imagem",s),s&&e.append("imagens_edit","true"),e.append("usuario",m.login.usuario),e.append("titulo",n),l!=""&&e.append("subtitulo",l),o&&e.append("original_format",o.toString()),x.post(v+"/admin/noticias_cadastro?type="+(u.current?"edit":"cadastro"),e,{arquivo:!0}).then(c=>{if(c.error)m.setRedirectError(c.error);else if(c.data.result=="true"){if(u.current){const p=new URLSearchParams(g.search);if(p.has("origin"))j(decodeURIComponent(p.get("origin")));else{const R=g.pathname.split("_");j(R[0]+"_lista")}u.current=!1,h.current=void 0}b(!0);var d=setTimeout(()=>{b(!1),clearInterval(d)},2e3);t.titulo.current.value="",t.subtitulo.current.value="",t.textarea.current.value="",t.imagem.current.value="",t.original_format.current.value="true",_("Upload"),f(null)}})},T=()=>{const r=["rd","of"],e=JSON.parse(t.original_format.current.value);t.image_element.current.classList.replace(r[+!e],r[+e])};return a.jsxs("div",{id:"pg",className:"nc",children:[a.jsxs("div",{id:"dt",className:"fechado",children:[a.jsx(M,{}),a.jsx("div",{id:"msg1",children:"Cadastrar matéria"}),a.jsxs("form",{onSubmit:F,children:[a.jsx("label",{children:"Título"}),a.jsx("input",{ref:t.titulo,className:"input",id:"titulo",placeholder:"Insira um título",required:!0}),a.jsx("label",{children:"Subtítulo"}),a.jsx("input",{ref:t.subtitulo,className:"input",id:"subtitulo",placeholder:"Insira um subtítulo"}),a.jsx("label",{children:"Texto"}),a.jsx("textarea",{ref:t.textarea}),a.jsx("label",{children:"Capa"}),a.jsxs("div",{id:"imagem-div",children:[a.jsx("div",{ref:t.imagem_view,id:"imagem-view",className:"col-12 col-md-6",children:a.jsx("img",{ref:t.image_element,className:"of",src:E.src})}),a.jsx("input",{className:"file",ref:t.imagem,onChange:U,type:"file",accept:"image/jpg, image/jpeg",required:!0}),a.jsxs("div",{id:"imagem-pt",children:[a.jsx("div",{id:"imagem",onClick:()=>{t.imagem.current.click()},children:a.jsx("div",{className:"txt-1",children:I})}),a.jsxs("select",{defaultValue:"true",onChange:T,ref:t.original_format,id:"original_format",children:[a.jsx("option",{value:"true",children:"Formato original"}),a.jsx("option",{value:"false",children:"Redimensionar"})]})]})]}),a.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),a.jsx("div",{id:"m",style:{display:N?"flex":"none"},children:u.current?"Matéria alterada com sucesso.":"Matéria cadastrada com sucesso."}),a.jsx("div",{id:"errorImage",style:{display:C?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{W as default};
