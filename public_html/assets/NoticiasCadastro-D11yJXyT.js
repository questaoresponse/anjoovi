import{r as m,u as ce,a as me,c as oe,b as ue,s as x,j as e}from"./index-DAOS0Jng.js";import{P as de}from"./Publicar-BCBklmpR.js";/* empty css             */const z=10000n<<18n|10000n;function fe(){const v=m.useRef(!1),I=m.useRef(),C=ce(),{server:w,cargo:B}=C,q=me(),D=oe(),n={permission:m.useRef(null),titulo:m.useRef(null),subtitulo:m.useRef(null),textarea:m.useRef(null),input:m.useRef(null),resize:m.useRef(null),image_view:m.useRef(null),image_element:m.useRef(null),image_premium:m.useRef(null),resize_premium:m.useRef(null),image_view_premium:m.useRef(null),image_element_premium:m.useRef(null)},S=ue(),[p,R]=m.useState({aspect:z,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:x}),[f,y]=m.useState({aspect:z,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:x}),[F,M]=m.useState({normal:0,premium:0}),[Q,G]=m.useState(!1),[X,J]=m.useState(!1),[H,Y]=m.useState(((B.current.cargo||0)&4)==4),[E,A]=m.useState(!1),Z=()=>{J(!0);const t=setTimeout(()=>{J(!1),clearTimeout(t)},2e3)},b=(t,i,o)=>{const{width:a,height:c}=n.image_view.current.getBoundingClientRect();var r=0,s=0,l=0,u=0;if(i<o)switch(t){case 0:r=i/o*a,s=c,l=r,u=s;break;case 1:r=a,s=c,l=r,u=o/i*c;break;case 2:r=c*4/5,s=c,l=r,u=s;break;case 3:r=a,s=a*9/16,l=r,u=o/i*c}else switch(t){case 0:r=a,s=o/i*c,l=r,u=s;break;case 1:r=a,s=c,l=i/o*a,u=c;break;case 2:r=c*4/5,s=c,l=i/o*a,u=c;break;case 3:r=a,s=a*9/16,l=r,u=s}const h=BigInt(Math.floor(l/u*1e4))&(1n<<18n)-1n,d=BigInt(t)<<18n,g=l>a?1n<<20n:0n;return[h|d|g,l+"px",u+"px",r+"px",s+"px"]},V=(t,i)=>{const o=t.target.files[0];if(o){const a=new FileReader;a.onloadend=()=>{const c=a.result instanceof ArrayBuffer?a.result:new ArrayBuffer(0),r=new Uint8Array(c),s={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let l=null;for(const[d,g]of Object.entries(s))if(g.every((_,N)=>_===r[N])){l=d;break}const u=i?F.premium:F.normal,h=i?y:R;if(l&&l=="jpeg"){const d=new FileReader;d.onloadend=()=>{var g="";typeof d.result=="string"?g=d.result:g=x;const j=new Image;j.src=g,j.onload=()=>{const{width:_,height:N}=j,[T,k,U,W,P]=b(u,_,N);h({aspect:T,elementWidth:k,elementHeight:U,imageWidth:_,imageHeight:N,width:W,height:P,filename:o.name,src:g})}},d.readAsDataURL(o)}else h(d=>({...d,filename:"Upload",src:x})),t.target.value="",Z()},a.readAsArrayBuffer(o)}};v.current=S.pathname=="/admin/noticias_edit";const L=m.useCallback(t=>{Y((t&4)==4)},[]),ee=()=>{H&&(n.permission.current.value=I.current.privado?"1":"0",A(!0))},O=m.useCallback(()=>{E&&y(t=>{if(t.src==x)return t;const i=Number(n.resize_premium.current.value)-1,[o,a,c,r,s]=b(i,t.imageWidth,t.imageHeight);return t.aspect=o,t.elementWidth=a,t.elementHeight=c,t.width=r,t.height=s,{...t}}),R(t=>{if(t.src==x)return t;const i=Number(n.resize.current.value)-1,[o,a,c,r,s]=b(i,t.imageWidth,t.imageHeight);return t.aspect=o,t.elementWidth=a,t.elementHeight=c,t.width=r,t.height=s,t})},[]);m.useEffect(()=>{C.setSelected("publicar"),v.current&&q.post(w+"/admin/noticias_edit"+S.search,{type:"info"}).then(t=>{if("post_edit"in t.data){n.input.current.required=!1;const i=t.data.post_edit[0];n.titulo.current.value=i.titulo,n.subtitulo.current.value=i.subtitulo,n.textarea.current.value=i.texto,i.privado=(i.privado&2)==2,H&&(n.permission.current.value=i.privado?"1":"0"),A(i.privado),I.current=i;const o=JSON.parse(i.imagem);for(const a of o){const c=new Image;c.src=w+"/images/"+encodeURIComponent(a),c.onload=()=>{const{width:r,height:s}=c;var l={normal:0,premium:0};const u=a.match(/^(.*)(_\d+_i).*\.webp/),h=BigInt(`0x${BigInt(parseInt(u[1],36)).toString(16)}`),d=h>>8n;if(H&&(h&1n)==1n){const k=d>>21n<<8n|2n,U=k.toString(36)+u[2]+"_premium.webp",W=new Image;W.src=w+"/images/"+encodeURIComponent(U),W.onload=()=>{const{width:P,height:K}=W;l.premium=Number(k>>26n&(1n<<2n)-1n);const[ne,re,ae,se,le]=b(l.premium,P,K);y({aspect:ne,imageWidth:P,imageHeight:K,elementWidth:re,elementHeight:ae,width:se,height:le,filename:"Image.webp",src:w+"/images/"+encodeURIComponent(U)})}}l.normal=Number(d>>18n&(1n<<2n)-1n);const[g,j,_,N,T]=b(l.normal,r,s);R({aspect:g,imageWidth:r,imageHeight:s,elementWidth:j,elementHeight:_,width:N,height:T,filename:"Image.webp",src:w+"/images/"+encodeURIComponent(a)}),M(l)}}}})},[]),m.useEffect(()=>(B.current.addListener(L),window.addEventListener("resize",O),()=>{B.current.removeListener(L),window.removeEventListener("resize",O)}),[L,O]),m.useEffect(()=>{I.current&&ee()},[H]);const te=async t=>{t.preventDefault();var i=new FormData;const o=n.titulo.current.value,a=n.subtitulo.current.value,c=n.textarea.current.value;var r=n.input.current.files.length>0?n.input.current.files[0]:null,s=n.image_premium.current&&n.image_premium.current.files.length>0?n.image_premium.current.files[0]:null;i.append("type","option"),v.current&&i.append("id",I.current.id.toString()),v.current&&(r||s)&&i.append("imagens_edit","true"),n.permission.current&&i.append("permission",n.permission.current.value),i.append("usuario",C.login.usuario),i.append("titulo",o),i.append("texto",c),a!=""&&i.append("subtitulo",a),i.append("original_format",Number(p.aspect).toString()),r&&i.append("imageFile",r),E&&(i.append("original_format_premium",Number(f.aspect).toString()),i.append("imageFilePremium",s)),q.post(w+"/admin/noticias_cadastro?type="+(v.current?"edit":"cadastro"),i,{arquivo:!0}).then(l=>{if(l.error)C.redirectError.current(l.error);else if(l.data.result=="true"){if(v.current){const h=new URLSearchParams(S.search);if(h.has("origin"))D(decodeURIComponent(h.get("origin")));else{const d=S.pathname.split("_");D(d[0]+"_lista")}v.current=!1,I.current=void 0}G(!0);var u=setTimeout(()=>{G(!1),clearInterval(u)},2e3);n.titulo.current.value="",n.subtitulo.current.value="",n.textarea.current.value="",n.input.current.value="",R({aspect:z,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:x}),y({aspect:z,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:x})}})},ie=t=>{A(t.target.value=="1")},$=t=>{const[i,o,a]=t?[Number(n.resize_premium.current.value),f.imageWidth,f.imageHeight]:[Number(n.resize.current.value),p.imageWidth,p.imageHeight],[c,r,s,l,u]=b(i-1,o,a);(t?y:R)(h=>({...h,aspect:c,elementWidth:r,elementHeight:s,width:l,height:u})),M(h=>({...h,[t?"premium":"normal"]:i}))};return e.jsxs("div",{id:"pg",className:"nc",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(de,{}),e.jsx("div",{id:"msg1",children:"Cadastrar matéria"}),e.jsxs("form",{onSubmit:te,children:[H?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:ie,ref:n.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Título"}),e.jsx("input",{ref:n.titulo,className:"input",id:"titulo",placeholder:"Insira um título",required:!0}),e.jsx("label",{children:"Subtítulo"}),e.jsx("input",{ref:n.subtitulo,className:"input",id:"subtitulo",placeholder:"Insira um subtítulo"}),e.jsx("label",{children:"Texto"}),e.jsx("textarea",{ref:n.textarea}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:n.image_view,className:"imagem-view col-12 col-md-6",children:e.jsx("div",{className:"image-container",style:{width:p.width,height:p.height},children:e.jsx("img",{className:"image-img",style:{width:p.elementWidth,height:p.elementHeight},ref:n.image_element,src:p.src})})}),e.jsx("input",{className:"file",ref:n.input,onChange:t=>V(t,!1),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{n.input.current.click()},children:e.jsx("div",{className:"txt-1",children:p.filename})}),e.jsxs("select",{value:String(F.normal+1),onChange:()=>$(!1),ref:n.resize,className:"original_format",children:[e.jsx("option",{value:"1",children:"Original"}),e.jsx("option",{value:"2",children:"1:1"}),e.jsx("option",{value:"3",children:"4:5"}),e.jsx("option",{value:"4",children:"16:9"})]})]})]}),E?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:n.image_view_premium,className:"imagem-view col-12 col-md-6",children:e.jsx("div",{className:"image-container",style:{width:f.width,height:f.height},children:e.jsx("img",{className:"image-img",style:{width:f.elementWidth,height:f.elementHeight},ref:n.image_element,src:f.src})})}),e.jsx("input",{className:"file",ref:n.image_premium,onChange:t=>V(t,!0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{n.image_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:f.filename})}),e.jsxs("select",{value:String(F.premium+1),onChange:()=>$(!0),ref:n.resize_premium,className:"original_format",children:[e.jsx("option",{value:"1",children:"Original"}),e.jsx("option",{value:"2",children:"1:1"}),e.jsx("option",{value:"3",children:"4:5"}),e.jsx("option",{value:"4",children:"16:9"})]})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:Q?"flex":"none"},children:v.current?"Matéria alterada com sucesso.":"Matéria cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:X?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{fe as default};
