import{r as s,u as K,a as Q,b as W,s as c,j as e}from"./index-BLsAr6dx.js";import{P as X}from"./Publicar-CQ9syHJN.js";/* empty css             */function ee(){const o=s.useRef(!1),u=s.useRef(),x=K(),{server:_,navigate:R,cargo:S}=x,y=Q(),a={permission:s.useRef(null),descricao:s.useRef(null),imagem:s.useRef(null),imagem_view:s.useRef(null),image_element:s.useRef(null),original_format:s.useRef(null),imagem_premium:s.useRef(null),original_format_premium:s.useRef(null),imagem_view_premium:s.useRef(null),image_element_premium:s.useRef(null)},p=W(),[L,C]=s.useState("Upload"),[O,P]=s.useState(!1),[k,b]=s.useState(!1),[D,d]=s.useState(c),[q,N]=s.useState(c),[B,w]=s.useState("Upload"),[l,J]=s.useState(((S.current.cargo||0)&4)==4),[T,F]=s.useState(!1),V=()=>{b(!0);const i=setTimeout(()=>{b(!1),clearTimeout(i)},2e3)},I=i=>{const r=i.target.files[0];if(r){const t=new FileReader;t.onloadend=()=>{const g=t.result instanceof ArrayBuffer?t.result:new ArrayBuffer(0),v=new Uint8Array(g),h={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let m=null;for(const[n,j]of Object.entries(h))if(j.every((z,H)=>z===v[H])){m=n;break}if(m&&m=="jpeg"){l?w(r.name):C(r.name);const n=new FileReader;n.onloadend=()=>{typeof n.result=="string"?l?N(n.result):d(n.result):l?N(c):d(c)},n.readAsDataURL(r)}else l?N(c):d(c),i.target.value="",V()},t.readAsArrayBuffer(r)}},U=i=>{J((i&4)==4)},A=()=>{l&&(a.permission.current.value=u.current.privado?"1":"0",F(!0))};s.useEffect(()=>(o.current=p.pathname=="/admin/imagens_edit",x.setSelected("publicar"),o.current&&y.post(_+"/admin/imagens_edit"+p.search,{type:"info"}).then(i=>{a.imagem.current.required=!1;const r=i.data.post_edit;a.descricao.current.value=r.descricao,r.privado=(r.privado&2)==2,u.current=r,A(),d(_+"/images/"+encodeURIComponent(r.imagem))}),S.current.addListener(U),()=>{S.current.removeListener(U)}),[]),s.useEffect(()=>{u.current&&A()},[l]);const G=async i=>{i.preventDefault();var r=new FormData,t=a.descricao.current.value,g=a.imagem.current.files.length>0?a.imagem.current.files[0]:null,v=JSON.parse(a.original_format.current.value),h=JSON.parse(a.original_format_premium.current.value);r.append("type","option"),o.current&&r.append("id",u.current.id.toString()),g&&r.append("imagem",g),g&&r.append("imagens_edit","true"),t!=""&&r.append("descricao",t),v&&r.append("original_format",v.toString()),h&&r.append("original_format",h.toString()),y.post(_+"/admin/products_cadastro?type="+(o.current?"edit":"cadastro"),r,{arquivo:!0}).then(m=>{if(m.error)x.setRedirectError(m.error);else if(m.data.result=="true"){if(o.current){const j=new URLSearchParams(p.search);if(j.has("origin"))R(decodeURIComponent(j.get("origin")));else{const E=p.pathname.split("_");R(E[0]+"_lista")}o.current=!1,u.current=void 0}P(!0);var n=setTimeout(()=>{P(!1),clearInterval(n)},2e3);a.descricao.current.value="",a.imagem.current.value="",a.original_format.current.value="true",d(c),f(!0),f(!1),w("Upload"),C("Upload")}})},M=i=>{F(i.target.value=="1")},f=i=>{const r=["rd","of"];if(i){const t=JSON.parse(a.original_format_premium.current.value);a.image_element_premium.current.classList.replace(r[+!t],r[+t])}else{const t=JSON.parse(a.original_format.current.value);a.image_element.current.classList.replace(r[+!t],r[+t])}};return e.jsxs("div",{id:"pg",className:"pdc",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(X,{}),e.jsx("div",{id:"msg1",children:"Cadastrar produto"}),e.jsxs("form",{onSubmit:G,children:[l?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:M,ref:a.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{ref:a.descricao}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:a.imagem_view,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:a.image_element,className:"of",src:D})}),e.jsx("input",{className:"file",ref:a.imagem,onChange:I,type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{a.imagem.current.click()},children:e.jsx("div",{className:"txt-1",children:L})}),e.jsxs("select",{defaultValue:"true",onChange:()=>f(!1),ref:a.original_format,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]}),T?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:a.imagem_view_premium,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:a.image_element_premium,className:"of",src:q})}),e.jsx("input",{className:"file",ref:a.imagem_premium,onChange:I,type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{a.imagem_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:B})}),e.jsxs("select",{defaultValue:"true",onChange:()=>f(!0),ref:a.original_format_premium,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:O?"flex":"none"},children:o.current?"Produto alterado com sucesso.":"Produto cadastrado com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:k?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{ee as default};
