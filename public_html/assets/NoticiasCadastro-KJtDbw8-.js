import{r,u as Q,a as X,c as Y,b as Z,s as x,j as e}from"./index-BqR8oZCD.js";import{P as $}from"./Publicar-C82uvpQX.js";/* empty css             */function ie(){const c=r.useRef(!1),p=r.useRef(),f=Q(),{server:h,cargo:_}=f,R=X(),S=Y(),a={permission:r.useRef(null),titulo:r.useRef(null),subtitulo:r.useRef(null),textarea:r.useRef(null),imagem:r.useRef(null),original_format:r.useRef(null),imagem_view:r.useRef(null),image_element:r.useRef(null),imagem_premium:r.useRef(null),original_format_premium:r.useRef(null),imagem_view_premium:r.useRef(null),image_element_premium:r.useRef(null)},v=Z(),[T,y]=r.useState("Upload"),[k,I]=r.useState(!1),[q,C]=r.useState(!1),[D,B]=r.useState("Upload"),[j,J]=r.useState(((_.current.cargo||0)&4)==4),[H,F]=r.useState(!1),M=()=>{C(!0);const i=setTimeout(()=>{C(!1),clearTimeout(i)},2e3)},[V,P]=r.useState({src:x,width:"100%",height:"100%"}),[W,U]=r.useState({src:x,width:"100%",height:"100%"}),g=(i,t)=>{if(typeof i=="string"){const s=new Image;s.onload=()=>{const o=a.imagem_view.current.offsetWidth,u=a.imagem_view.current.offsetHeight;var l=s.width,n=s.height;o/l*n>u?(l=u/n*l,n=u):(n=o/l*n,l=o),t?U({src:i,width:l,height:n}):P({src:i,width:l,height:n})},s.src=i}else t?U({src:x,width:window.innerWidth,height:window.innerHeight/1280*720}):P({src:x,width:window.innerWidth,height:window.innerHeight/1280*720})},A=(i,t)=>{const s=i.target.files[0];if(s){const o=new FileReader;o.onloadend=()=>{const u=o.result instanceof ArrayBuffer?o.result:new ArrayBuffer(0),l=new Uint8Array(u),n={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let d=null;for(const[m,w]of Object.entries(n))if(w.every((N,K)=>N===l[K])){d=m;break}if(d&&d=="jpeg"){t?B(s.name):y(s.name);const m=new FileReader;m.onloadend=()=>{g(m.result,t)},m.readAsDataURL(s)}else g(null,t),i.target.value="",M()},o.readAsArrayBuffer(s)}};c.current=v.pathname=="/admin/noticias_edit";const E=i=>{J((i&4)==4)},L=()=>{j&&(a.permission.current.value=p.current.privado?"1":"0",F(!0))};r.useEffect(()=>(f.setSelected("publicar"),c.current&&R.post(h+"/admin/noticias_edit"+v.search,{type:"info"}).then(i=>{if("post_edit"in i.data){a.imagem.current.required=!1;const t=i.data.post_edit[0];a.titulo.current.value=t.titulo,a.subtitulo.current.value=t.subtitulo,a.textarea.current.value=t.texto,t.privado=(t.privado&2)==2,p.current=t,L(),t.privado&&g(h+"/images/"+encodeURIComponent(t.imagem),!0),g(h+"/images/"+encodeURIComponent(t.imagem),!1)}}),_.current.addListener(E),()=>{_.current.removeListener(E)}),[]),r.useEffect(()=>{p.current&&L()},[j]);const G=async i=>{i.preventDefault();var t=new FormData,s=a.titulo.current.value,o=a.subtitulo.current.value,u=JSON.parse(a.original_format.current.value),l=a.original_format_premium.current?JSON.parse(a.original_format_premium.current.value):null,n=a.imagem.current.files.length>0?a.imagem.current.files[0]:null,d=a.imagem_premium&&a.imagem_premium.current.files.length>0?a.imagem_premium.current.files[0]:null;t.append("type","option"),c.current&&t.append("id",p.current.id.toString()),n&&t.append("imagem",n),d&&t.append("dImagem",d),(n||d)&&t.append("imagens_edit","true"),a.permission.current&&t.append("permission",a.permission.current.value),t.append("usuario",f.login.usuario),t.append("titulo",s),o!=""&&t.append("subtitulo",o),u&&t.append("original_format",u.toString()),l&&t.append("original_format",l.toString()),R.post(h+"/admin/noticias_cadastro?type="+(c.current?"edit":"cadastro"),t,{arquivo:!0}).then(m=>{if(m.error)f.setRedirectError(m.error);else if(m.data.result=="true"){if(c.current){const b=new URLSearchParams(v.search);if(b.has("origin"))S(decodeURIComponent(b.get("origin")));else{const N=v.pathname.split("_");S(N[0]+"_lista")}c.current=!1,p.current=void 0}I(!0);var w=setTimeout(()=>{I(!1),clearInterval(w)},2e3);a.titulo.current.value="",a.subtitulo.current.value="",a.textarea.current.value="",a.imagem.current.value="",a.original_format.current.value="true",y("Upload"),g(null,!0),g(null,!1)}})},z=i=>{F(i.target.value=="1")},O=i=>{const t=["rd","of"];if(i){const s=JSON.parse(a.original_format_premium.current.value);a.image_element_premium.current.classList.replace(t[+!s],t[+s])}else{const s=JSON.parse(a.original_format.current.value);a.image_element.current.classList.replace(t[+!s],t[+s])}};return e.jsxs("div",{id:"pg",className:"nc",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx($,{}),e.jsx("div",{id:"msg1",children:"Cadastrar matéria"}),e.jsxs("form",{onSubmit:G,children:[j?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:z,ref:a.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Título"}),e.jsx("input",{ref:a.titulo,className:"input",id:"titulo",placeholder:"Insira um título",required:!0}),e.jsx("label",{children:"Subtítulo"}),e.jsx("input",{ref:a.subtitulo,className:"input",id:"subtitulo",placeholder:"Insira um subtítulo"}),e.jsx("label",{children:"Texto"}),e.jsx("textarea",{ref:a.textarea}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:a.imagem_view,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:a.image_element,className:"of",src:V.src})}),e.jsx("input",{className:"file",ref:a.imagem,onChange:i=>A(i,!1),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{a.imagem.current.click()},children:e.jsx("div",{className:"txt-1",children:T})}),e.jsxs("select",{defaultValue:"true",onChange:()=>O(!1),ref:a.original_format,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]}),H?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:a.imagem_view_premium,id:"",className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:a.image_element_premium,className:"of",src:W.src})}),e.jsx("input",{className:"file",ref:a.imagem_premium,onChange:i=>A(i,!0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{a.imagem_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:D})}),e.jsxs("select",{defaultValue:"true",onChange:()=>O(!0),ref:a.original_format_premium,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:k?"flex":"none"},children:c.current?"Matéria alterada com sucesso.":"Matéria cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:q?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{ie as default};
