import{r as m,u as le,a as me,c as oe,b as ce,s as _,j as e}from"./index-BKQN64Pe.js";import{P as ue}from"./Publicar-C-P23GlA.js";/* empty css             */const B=10000n<<18n|10000n;function he(){const v=m.useRef(!1),N=m.useRef(),R=le(),{server:j,cargo:A}=R,O=me(),T=oe(),t={permission:m.useRef(null),titulo:m.useRef(null),subtitulo:m.useRef(null),textarea:m.useRef(null),input:m.useRef(null),resize:m.useRef(null),image_view:m.useRef(null),image_element:m.useRef(null),image_premium:m.useRef(null),resize_premium:m.useRef(null),image_view_premium:m.useRef(null),image_element_premium:m.useRef(null)},S=ce(),[h,C]=m.useState({aspect:B,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:_}),[f,H]=m.useState({aspect:B,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:_}),[W,q]=m.useState({normal:1,premium:1}),[K,D]=m.useState(!1),[Q,L]=m.useState(!1),[I,X]=m.useState(((A.current.cargo||0)&4)==4),[M,E]=m.useState(!1),Y=()=>{L(!0);const r=setTimeout(()=>{L(!1),clearTimeout(r)},2e3)},F=(r,i,u)=>{const{width:s,height:o}=t.image_view.current.getBoundingClientRect();var n=0,l=0,a=0,c=0;if(i<u)switch(r){case 0:n=i/u*s,l=o,a=n,c=l;break;case 1:n=s,l=o,a=n,c=u/i*o;break;case 2:n=o*4/5,l=o,a=n,c=l;break;case 3:n=s,l=s*9/16,a=n,c=u/i*o}else switch(r){case 0:n=s,l=u/i*o,a=n,c=l;break;case 1:n=s,l=o,a=i/u*s,c=o;break;case 2:n=o*4/5,l=o,a=i/u*s,c=o;break;case 3:n=s,l=s*9/16,a=n,c=l}const g=BigInt(Math.floor(a/c*1e4))&(1n<<18n)-1n,d=BigInt(r)<<18n,p=a>s?1n<<20n:0n;return[g|d|p,a+"px",c+"px",n+"px",l+"px"]},G=(r,i)=>{const u=r.target.files[0];if(u){const s=new FileReader;s.onloadend=()=>{const o=s.result instanceof ArrayBuffer?s.result:new ArrayBuffer(0),n=new Uint8Array(o),l={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let a=null;for(const[d,p]of Object.entries(l))if(p.every((b,w)=>b===n[w])){a=d;break}const c=(i?W.premium:W.normal)-1,g=i?H:C;if(a&&a=="jpeg"){const d=new FileReader;d.onloadend=()=>{var p="";typeof d.result=="string"?p=d.result:p=_;const x=new Image;x.src=p,x.onload=()=>{const{width:b,height:w}=x,[z,U,P,y,k]=F(c,b,w);g({aspect:z,elementWidth:U,elementHeight:P,imageWidth:b,imageHeight:w,width:y,height:k,filename:u.name,src:p})}},d.readAsDataURL(u)}else g(d=>({...d,filename:"Upload",src:_})),r.target.value="",Y()},s.readAsArrayBuffer(u)}};v.current=S.pathname=="/admin/noticias_edit";const J=r=>{X((r&4)==4)},Z=()=>{I&&(t.permission.current.value=N.current.privado?"1":"0",E(!0))};m.useEffect(()=>(R.setSelected("publicar"),v.current&&O.post(j+"/admin/noticias_edit"+S.search,{type:"info"}).then(r=>{if("post_edit"in r.data){t.input.current.required=!1;const i=r.data.post_edit[0];t.titulo.current.value=i.titulo,t.subtitulo.current.value=i.subtitulo,t.textarea.current.value=i.texto,i.privado=(i.privado&2)==2,I&&(t.permission.current.value=i.privado?"1":"0"),E(i.privado),N.current=i;const u=JSON.parse(i.imagem);for(const s of u){const o=new Image;o.src=j+"/images/"+encodeURIComponent(s),o.onload=()=>{const{width:n,height:l}=o;var a={normal:1,premium:1};const c=s.match(/^(.*)(_\d+_i).*\.webp/),g=BigInt(`0x${BigInt(parseInt(c[1],36)).toString(16)}`),d=g>>8n;if(I&&(g&1n)==1n){const U=d>>21n<<8n|2n,P=U.toString(36)+c[2]+"_premium.webp",y=new Image;y.src=j+"/images/"+encodeURIComponent(P),y.onload=()=>{const{width:k,height:$}=y;a.premium=Number(U>>26n&(1n<<2n)-1n);const[ie,ae,ne,re,se]=F(a.premium,k,$);H({aspect:ie,imageWidth:k,imageHeight:$,elementWidth:ae,elementHeight:ne,width:re,height:se,filename:"Image.webp",src:j+"/images/"+encodeURIComponent(P)})}}a.normal=Number(d>>18n&(1n<<2n)-1n);const[p,x,b,w,z]=F(a.normal,n,l);C({aspect:p,imageWidth:n,imageHeight:l,elementWidth:x,elementHeight:b,width:w,height:z,filename:"Image.webp",src:j+"/images/"+encodeURIComponent(s)}),q(a)}}}}),A.current.addListener(J),()=>{A.current.removeListener(J)}),[]),m.useEffect(()=>{N.current&&Z()},[I]);const ee=async r=>{r.preventDefault();var i=new FormData;const u=t.titulo.current.value,s=t.subtitulo.current.value,o=t.textarea.current.value;var n=t.input.current.files.length>0?t.input.current.files[0]:null,l=t.image_premium.current&&t.image_premium.current.files.length>0?t.image_premium.current.files[0]:null;i.append("type","option"),v.current&&i.append("id",N.current.id.toString()),v.current&&(n||l)&&i.append("imagens_edit","true"),t.permission.current&&i.append("permission",t.permission.current.value),i.append("usuario",R.login.usuario),i.append("titulo",u),i.append("texto",o),s!=""&&i.append("subtitulo",s),i.append("original_format",Number(h.aspect).toString()),n&&i.append("imageFile",n),M&&(i.append("original_format_premium",Number(f.aspect).toString()),i.append("imageFilePremium",l)),O.post(j+"/admin/noticias_cadastro?type="+(v.current?"edit":"cadastro"),i,{arquivo:!0}).then(a=>{if(a.error)R.redirectError.current(a.error);else if(a.data.result=="true"){if(v.current){const g=new URLSearchParams(S.search);if(g.has("origin"))T(decodeURIComponent(g.get("origin")));else{const d=S.pathname.split("_");T(d[0]+"_lista")}v.current=!1,N.current=void 0}D(!0);var c=setTimeout(()=>{D(!1),clearInterval(c)},2e3);t.titulo.current.value="",t.subtitulo.current.value="",t.textarea.current.value="",t.input.current.value="",C({aspect:B,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:_}),H({aspect:B,imageWidth:0,imageHeight:0,elementWidth:"100%",elementHeight:"100%",width:"100%",height:"100%",filename:"Upload",src:_})}})},te=r=>{E(r.target.value=="1")},V=r=>{const[i,u,s]=r?[Number(t.resize_premium.current.value),f.imageWidth,f.imageHeight]:[Number(t.resize.current.value),h.imageWidth,h.imageHeight],[o,n,l,a,c]=F(i-1,u,s);(r?H:C)(g=>({...g,aspect:o,elementWidth:n,elementHeight:l,width:a,height:c})),q(g=>({...g,[r?"premium":"normal"]:i}))};return e.jsxs("div",{id:"pg",className:"nc",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(ue,{}),e.jsx("div",{id:"msg1",children:"Cadastrar matéria"}),e.jsxs("form",{onSubmit:ee,children:[I?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:te,ref:t.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Título"}),e.jsx("input",{ref:t.titulo,className:"input",id:"titulo",placeholder:"Insira um título",required:!0}),e.jsx("label",{children:"Subtítulo"}),e.jsx("input",{ref:t.subtitulo,className:"input",id:"subtitulo",placeholder:"Insira um subtítulo"}),e.jsx("label",{children:"Texto"}),e.jsx("textarea",{ref:t.textarea}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:t.image_view,className:"imagem-view col-12 col-md-6",children:e.jsx("div",{className:"image-container",style:{width:h.width,height:h.height},children:e.jsx("img",{className:"image-img",style:{width:h.elementWidth,height:h.elementHeight},ref:t.image_element,src:h.src})})}),e.jsx("input",{className:"file",ref:t.input,onChange:r=>G(r,!1),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{t.input.current.click()},children:e.jsx("div",{className:"txt-1",children:h.filename})}),e.jsxs("select",{value:String(W.normal),onChange:()=>V(!1),ref:t.resize,className:"original_format",children:[e.jsx("option",{value:"1",children:"Original"}),e.jsx("option",{value:"2",children:"1:1"}),e.jsx("option",{value:"3",children:"4:5"}),e.jsx("option",{value:"4",children:"16:9"})]})]})]}),M?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:t.image_view_premium,className:"imagem-view col-12 col-md-6",children:e.jsx("div",{className:"image-container",style:{width:f.width,height:f.height},children:e.jsx("img",{className:"image-img",style:{width:f.elementWidth,height:f.elementHeight},ref:t.image_element,src:f.src})})}),e.jsx("input",{className:"file",ref:t.image_premium,onChange:r=>G(r,!0),type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{t.image_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:f.filename})}),e.jsxs("select",{value:String(W.premium),onChange:()=>V(!0),ref:t.resize_premium,className:"original_format",children:[e.jsx("option",{value:"1",children:"Original"}),e.jsx("option",{value:"2",children:"1:1"}),e.jsx("option",{value:"3",children:"4:5"}),e.jsx("option",{value:"4",children:"16:9"})]})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:K?"flex":"none"},children:v.current?"Matéria alterada com sucesso.":"Matéria cadastrada com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:Q?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{he as default};
