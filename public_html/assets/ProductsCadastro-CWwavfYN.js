import{r as i,u as K,a as Q,b as W,s as o,j as e}from"./index-DrGgFpj5.js";import{P as X}from"./Publicar-5rtgRSds.js";/* empty css             */function ee(){const m=i.useRef(!1),u=i.useRef(),_=K(),{server:j,navigate:C,cargo:x}=_,P=Q(),r={permission:i.useRef(null),descricao:i.useRef(null),imagem:i.useRef(null),imagem_view:i.useRef(null),image_element:i.useRef(null),original_format:i.useRef(null),imagem_premium:i.useRef(null),original_format_premium:i.useRef(null),imagem_view_premium:i.useRef(null),image_element_premium:i.useRef(null)},f=W(),[O,b]=i.useState("Upload"),[k,w]=i.useState(!1),[D,F]=i.useState(!1),[q,d]=i.useState(o),[B,S]=i.useState(o),[J,I]=i.useState("Upload"),[l,T]=i.useState(((x.current.cargo||0)&4)==4),[V,U]=i.useState(!1),G=()=>{F(!0);const s=setTimeout(()=>{F(!1),clearTimeout(s)},2e3)},A=s=>{const a=s.target.files[0];if(a){const t=new FileReader;t.onloadend=()=>{const g=t.result instanceof ArrayBuffer?t.result:new ArrayBuffer(0),p=new Uint8Array(g),h={jpeg:[255,216,255],png:[137,80,78,71,13,10,26,10],gif:[71,73,70]};let c=null;for(const[n,N]of Object.entries(h))if(N.every((R,H)=>R===p[H])){c=n;break}if(c&&c=="jpeg"){l?I(a.name):b(a.name);const n=new FileReader;n.onloadend=()=>{typeof n.result=="string"?l?S(n.result):d(n.result):l?S(o):d(o)},n.readAsDataURL(a)}else l?S(o):d(o),s.target.value="",G()},t.readAsArrayBuffer(a)}},E=s=>{T((s&4)==4)},L=()=>{l&&(r.permission.current.value=u.current.privado?"1":"0",U(!0))};i.useEffect(()=>(m.current=f.pathname=="/admin/imagens_edit",_.setSelected("publicar"),m.current&&P.post(j+"/admin/imagens_edit"+f.search,{type:"info"}).then(s=>{r.imagem.current.required=!1;const a=s.data.post_edit;r.descricao.current.value=a.descricao,a.privado=(a.privado&2)==2,u.current=a,L(),d(j+"/images/"+encodeURIComponent(a.imagem))}),x.current.addListener(E),()=>{x.current.removeListener(E)}),[]),i.useEffect(()=>{u.current&&L()},[l]);const M=async s=>{s.preventDefault();var a=new FormData,t=r.descricao.current.value,g=r.imagem.current.files.length>0?r.imagem.current.files[0]:null,p=r.imagem_premium.current&&r.imagem_premium.current.files.length>0?r.imagem_premium.current.files[0]:null,h=JSON.parse(r.original_format.current.value),c=r.original_format_premium.current?JSON.parse(r.original_format_premium.current.value):null;a.append("type","option"),m.current&&a.append("id",u.current.id.toString()),g&&a.append("imagem",g),p&&a.append("imagem",p),(g||p)&&a.append("imagens_edit","true"),t!=""&&a.append("descricao",t),h&&a.append("original_format",h.toString()),c&&a.append("original_format",c.toString()),P.post(j+"/admin/products_cadastro?type="+(m.current?"edit":"cadastro"),a,{arquivo:!0}).then(n=>{if(n.error)_.redirectError.current(n.error);else if(n.data.result=="true"){if(m.current){const y=new URLSearchParams(f.search);if(y.has("origin"))C(decodeURIComponent(y.get("origin")));else{const R=f.pathname.split("_");C(R[0]+"_lista")}m.current=!1,u.current=void 0}w(!0);var N=setTimeout(()=>{w(!1),clearInterval(N)},2e3);r.descricao.current.value="",r.imagem.current.value="",r.original_format.current.value="true",d(o),v(!0),v(!1),I("Upload"),b("Upload")}})},z=s=>{U(s.target.value=="1")},v=s=>{const a=["rd","of"];if(s){const t=JSON.parse(r.original_format_premium.current.value);r.image_element_premium.current.classList.replace(a[+!t],a[+t])}else{const t=JSON.parse(r.original_format.current.value);r.image_element.current.classList.replace(a[+!t],a[+t])}};return e.jsxs("div",{id:"pg",className:"pdc",children:[e.jsxs("div",{id:"dt",className:"fechado",children:[e.jsx(X,{}),e.jsx("div",{id:"msg1",children:"Cadastrar produto"}),e.jsxs("form",{onSubmit:M,children:[l?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Disponível:"}),e.jsxs("select",{onChange:z,ref:r.permission,id:"permission",defaultValue:"0",children:[e.jsx("option",{value:"0",children:"Público"}),e.jsx("option",{value:"1",children:"Premium"})]})]}):e.jsx(e.Fragment,{}),e.jsx("label",{children:"Descrição"}),e.jsx("textarea",{ref:r.descricao}),e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:r.imagem_view,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:r.image_element,className:"of",src:q})}),e.jsx("input",{className:"file",ref:r.imagem,onChange:A,type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{r.imagem.current.click()},children:e.jsx("div",{className:"txt-1",children:O})}),e.jsxs("select",{defaultValue:"true",onChange:()=>v(!1),ref:r.original_format,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]}),V?e.jsxs(e.Fragment,{children:[e.jsx("label",{children:"Capa"}),e.jsxs("div",{className:"imagem-div",children:[e.jsx("div",{ref:r.imagem_view_premium,className:"imagem-view col-12 col-md-6",children:e.jsx("img",{ref:r.image_element_premium,className:"of",src:B})}),e.jsx("input",{className:"file",ref:r.imagem_premium,onChange:A,type:"file",accept:"image/jpg, image/jpeg",required:!0}),e.jsxs("div",{className:"imagem-pt",children:[e.jsx("div",{className:"imagem",onClick:()=>{r.imagem_premium.current.click()},children:e.jsx("div",{className:"txt-1",children:J})}),e.jsxs("select",{defaultValue:"true",onChange:()=>v(!0),ref:r.original_format_premium,className:"original_format",children:[e.jsx("option",{value:"true",children:"Formato original"}),e.jsx("option",{value:"false",children:"Redimensionar"})]})]})]})]}):e.jsx(e.Fragment,{}),e.jsx("button",{type:"submit",id:"button",children:"Enviar"})]})]}),e.jsx("div",{id:"m",style:{display:k?"flex":"none"},children:m.current?"Produto alterado com sucesso.":"Produto cadastrado com sucesso."}),e.jsx("div",{id:"errorImage",style:{display:D?"flex":"none"},children:"O tipo da imagem não corresponde a jpg/jpeg. Selecione uma imagem válida."})]})}export{ee as default};
